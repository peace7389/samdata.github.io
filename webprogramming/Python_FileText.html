<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!-- for responsive web design -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- for SEO -->
<meta name="description" content="Python Tutorial - File and Text Processing">
<meta name="keywords" content="Python, Tutorial, File processing, Text processing">
<title>Python Tutorial - File and Text Processing</title>

<!-- @@ v3 header changes starts here after <title> -->
<!-- My custom CSS v3 -->
<link rel="stylesheet" href="../css/programming_notes_v3.css">
<!-- Prism Syntax Highlighter -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-highlight/prism-line-highlight.min.css" rel="stylesheet" />
<!-- favicon -->
<link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
</head>

<body>

<div id="wrap-outer">

<!-- header filled by JavaScript -->
<div id="header" class="header"><p>&nbsp;</p></div>

<div id="wrap-inner">

<div id="wrap-toc">
<h5>Table of Contents <a id="show-toc" href="Python_FileText.html#show-toc">(Hide)</a></h5>
<div id="toc"></div>  <!-- for showing the "Table of Content" -->
</div>

<!-- @@ v3 header changes ends here before "content-header" <h1> and <h2>"" -->
<div id="content-header">
<h1>Python</h1>
<h2> File  and Text Processing</h2>
</div>

<div id="content-main">

<!-- @@ end change in v1 -->

<h3 id="FileIO">File Input/Output</h3>
<p>File Input/Output (IO) requires 3 steps:</p>

<ol>
<li>Open the file for read or write or both.</li>
<li>Read/Write data.</li>
<li>Close the file to free the resources.</li>
</ol>
<p>Python provides built-in functions and external modules to support these operations.</p>

<h4>Opening/Closing a File</h4>

<ul>
<li><span class="lead-code">open(<em>file</em>, [<em>mode</em>='r']) -&gt; <em>fileObj</em></span>: Open the <code><em>file</em></code> and return a file object. The available modes are: <code>'r'</code> (read-only) (default), <code>'w'</code> (write - erase all contents for existing file), <code>'a'</code> (append), <code>'r+'</code> (read and write).  You can also use <code>'rb'</code>, <code>'wb'</code>, <code>'ab'</code>, <code>'rb+'</code> for <em>binary</em> mode (raw-byte) operations. You can optionally specify the text encoding via keyword parameter <code>encoding</code>, e.g., <code>encoding=&quot;utf-8&quot;</code>.</li>

<li><span class="lead-code"><em>fileObj</em>.close()</span>: Flush and close the file stream.</li>
</ul>

<h4>Reading/Writing Text Files</h4>

<p>The <code><em>fileObj</em></code> returned after the file is opened maintains a <em>file pointer</em>. It initially positions at the beginning of the file and  advances whenever read/write operations are performed.</p>

<h5>Reading Line/Lines from a Text File</h5>
<ul>
<li><span class="lead-code"><em>fileObj</em>.readline() -&gt; str</span>:  (most commonly-used) Read next line (up to and including newline) and return a string (including newline). It returns an empty string after the end-of-file (EOF).</li>

<li><span class="lead-code"><em>fileObj</em>.readlines() -&gt; [str]</span>: Read all lines into a list of strings.</li>

<li><span class="lead-code"><em>fileObj</em>.read() -&gt; str</span>: Read the entire file into a string.</li>
</ul>

<h5>Writing Line to a Text File</h5>
<ul>
<li><span class="lead-code"><em>fileObj</em>.write(<em>str</em>) -&gt; int</span>: Write the given string to the file and return the number of characters written. You need to explicitly terminate the <code><em>str</em></code> with a <code>'\n'</code>, if needed. The <code>'\n'</code> will be translated to the platform-dependent newline (<code>'\r\n'</code> for Windows or <code>'\n'</code> for Unixes/macOS).</li>
</ul>

<h5>Examples</h5>

<pre class="example">
<span class="comment"># Open a file for writing and insert some records</span>
&gt;&gt;&gt; <strong>f = open('test.txt', 'w')</strong>
&gt;&gt;&gt; <strong>f.write('apple\n')</strong>
&gt;&gt;&gt; <strong>f.write('orange\n')</strong>
&gt;&gt;&gt; <strong>f.write('pear\n')</strong>
&gt;&gt;&gt; <strong>f.close()</strong>    <span class="comment"># Always close the file</span>
<span class="comment"># Check the contents of the file created</span>

<span class="comment"># Open the file created for reading and read line(s) using readline() and readlines()</span>
&gt;&gt;&gt; <strong>f = open('test.txt', 'r')</strong>
&gt;&gt;&gt; <strong>f.readline()</strong>         <span class="comment"># Read next line into a string</span>
'apple\n'
&gt;&gt;&gt; <strong>f.readlines()</strong>        <span class="comment"># Read all (next) lines into a list of strings</span>
['orange\n', 'pear\n']
&gt;&gt;&gt; <strong>f.readline()</strong>         <span class="comment"># Return an empty string after EOF</span>
''
&gt;&gt;&gt; <strong>f.close()</strong>

<span class="comment"># Open the file for reading and read the entire file via read()</span> 
&gt;&gt;&gt; <strong>f = open('test.txt', 'r')</strong>
&gt;&gt;&gt; <strong>f.read()</strong>              <span class="comment"># Read entire file into a string</span>
'apple\norange\npear\n'
&gt;&gt;&gt; <strong>f.close()</strong>

<span class="comment"># Read line-by-line using readline() in a while-loop</span>
&gt;&gt;&gt; <strong>f = open('test.txt')</strong>
&gt;&gt;&gt; <strong>line = f.readline()</strong>   <span class="comment"># include newline</span>
&gt;&gt;&gt; <strong>while line:
        line = line.rstrip()</strong>  <span class="comment"># strip trailing spaces and newline</span>
        <span class="comment"># process the line</span>
        <strong>print(line)</strong>
        <strong>line = f.readline()</strong>
apple
orange
pear
&gt;&gt;&gt; <strong>f.close()</strong>
</pre>

<h4>Processing Text File Line-by-Line</h4>

<p>We can use a <code>with</code>-statement to open a file, which will be closed automatically upon exit, and a <code>for</code>-loop to read line-by-line as follows:</p>
<pre class="example">
with open('path/to/file.txt', 'r') as f:  <span class="comment"># Open file for read</span>
    for line in f:           <span class="comment"># Read line-by-line</span>
        line = line.strip()  <span class="comment"># Strip the leading/trailing whitespaces and newline</span>
       <span class="comment"> # Process the line</span>
<span class="comment"># File closed automatically upon exit of with-statement</span></pre>

<p>The <code>with</code>-statement is equivalent to the <code>try-finally</code> statement as follows:</p>

<pre class="example">
try:
    f = open('path/to/file.txt')
    for line in f:
        line = line.strip()
        <span class="comment"># Process the line</span>
finally:
    f.close()</pre>


<h5>Example: Line-by-line File Copy</h5>
<p>The following script copies a file into another line-by-line, prepending each line with the line number.</p>

<pre><code class="language-python line-numbers">#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
"""
file_copy: Copy file line-by-line from source to destination
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Usage: file_copy &lt;src&gt; &lt;dest&gt;
"""
import sys
import os

def main():
    # Check and retrieve command-line arguments
    if len(sys.argv) != 3:
        print(__doc__)
        sys.exit(1)   # Return a non-zero value to indicate abnormal termination
    fileIn  = sys.argv[1]
    fileOut = sys.argv[2]

    # Verify source file
    if not os.path.isfile(fileIn):
        print("error: {} does not exist".format(fileIn))
        sys.exit(1)

    # Verify destination file
    if os.path.isfile(fileOut):
        print("{} exists. Override (y/n)?".format(fileOut))
        reply = input().strip().lower()
        if reply[0] != 'y':
           sys.exit(1)

    # Process the file line-by-line
    with open(fileIn, 'r') as fpIn, open(fileOut, 'w') as fpOut:
        lineNumber = 0
        for line in fpIn:
            lineNumber += 1
            line = line.rstrip()   # Strip trailing spaces and newline
            fpOut.write("{}: {}\n".format(lineNumber, line))
            # Need \n, which will be translated to platform-dependent newline
        print("Number of lines: {}\n".format(lineNumber))

if __name__ == '__main__':
    main()</code></pre>

<h4>Binary File Operations</h4>
<p>[TODO] Intro</p>
<ul>
<li><span class="lead-code"><em>fileObj</em>.tell() -&gt; int</span>: returns the current stream position. The current stream position is the number of bytes from the beginning of the file in binary mode, and an opaque number in text mode.</li>

<li><span class="lead-code"><em>fileObj</em>.seek(<em>offset</em>)</span>: sets the current stream position to <code><em>offset</em></code> bytes from the beginning of the file.</li>
</ul>

<p>For example [TODO]</p>


<h3 id="FileSystem">Directory and File Management</h3>

<p>In Python, directory and file management are supported by modules <code>os</code>, <code>os.path</code>, <code>shutil</code>, ...</p>

<h4>Path Operations Using Module <code>os.path</code></h4>
<p>In Python, a <em>path</em> could refer to:</p>
<ol>
<li>a file,</li>
<li>a directory, or</li>
<li>a symlink (symbolic link).</li>
</ol>
<p>A <em>path</em> could be absolute (beginning with root) or relative to the current working directory (CWD).</p>

<p>The <em>path separator</em> is platform-dependent (Windows use <code>'\'</code>, while Unixes/macOS use '<code>/'</code>). The <code>os.path</code> module supports platform-independent operations on paths, by handling the path separator intelligently.</p>

<h5>Checking Path Existence and Type</h5>
<ul>
<li><span class="lead-code">os.path.exists(<em>path</em>) -&gt; bool</span>: Check if the given path exists.</li>

<li><span class="lead-code">os.path.isfile(<em>file_path</em>), os.path.isdir(<em>dir_path</em>), os.path.islink(<em>link_path</em>) -&gt; bool</span>: Check if the given path is a file, a directory, or a symlink.</li>
</ul>

<p>For examples,</p>
<pre class="example">
&gt;&gt;&gt; <strong>import os</strong>
&gt;&gt;&gt; <strong>os.path.exists('/usr/bin')</strong>  <span class="comment"># Check if the path exists (as a file/directory/Symlink)</span>
True
&gt;&gt;&gt; <strong>os.path.isfile('/usr/bin')</strong>  <span class="comment"># Check if path is a file</span>
False
&gt;&gt;&gt; <strong>os.path.isdir('/usr/bin')</strong>   <span class="comment"># Check if path is a directory</span>
True</pre>


<h5>Forming a New Path</h5>
<p>The path separator is platform-dependent (Windows use <code>'\'</code>, while Unixes/macOS use <code>'/'</code>).  For portability, It is important NOT to hardcode the path separator. The <code>os.path</code> module supports platform-independent operations on paths, by handling the path separator intelligently.</p>
<ul>
<li><span class="lead-code">os.path.sep</span>: the path separator of the current system.</li>

<li><span class="lead-code">os.path.join(<em>path</em>, *<em>paths</em>)</span>: Form and return a  path by joining one or more path components by inserting the platform-dependent path separator (<code>'/'</code> or <code>'\'</code>). To form an absolute path, you need to begin with a <code>os.path.sep</code>, as root.</li>
</ul>

<p>For examples,</p>
<pre class="example">
&gt;&gt;&gt; <strong>import os</strong>
&gt;&gt;&gt; <strong>print(os.path.sep)</strong>    <span class="comment"># Path Separator</span>
/

<span class="comment"># Form an absolute path beginning with root</span>
&gt;&gt;&gt; <strong>print(os.path.join(os.path.sep, 'etc', 'apache2', 'httpd.conf'))</strong>
/etc/apache2/httpd.conf

<span class="comment"># Form a relative path</span>
&gt;&gt;&gt; <strong>print(os.path.join('..', 'apache2', 'httpd.conf'))</strong>
../apache2/httpd.conf</pre>

<h5>Manipulating Directory-name and Filename</h5>
<ul>
<li><span class="lead-code">os.path.dirname(<em>path</em>)</span>: Return the <em>directory name</em> of the given <code><em>path</em></code> (file, directory or symlink). The returned directory name could be absolute or relative, depending on the <code><em>path</em></code> given.</li>

<li><span class="lead-code">os.path.abspath(<em>path</em>)</span>: Return the <em>absolute path name</em> (starting from the root) of the given <em><code>path</code></em>. This could be an absolute filename, an absolute directory-name, or an absolute symlink.</li>
</ul>

<p>For example, to form an <em>absolute path</em> of a file called <code>out.txt</code> in the same directory as <code>in.txt</code>, you may extract the absolute directory name of the <code>in.txt</code>, then join with <code>out.txt</code>, as follows:</p>

<pre class="example">
<span class="comment"># Absolute filename</span>
os.path.join(os.path.dirname(os.path.abspath('in.txt')), 'out.txt')
<span class="comment"># Relative filename</span>
os.path.join(os.path.dirname('in.txt'), 'out.txt')</pre>

<p>For example,</p>
<pre class="example">
<span class="comment">#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
</span><span class="comment">&quot;&quot;&quot; test_ospath.py &quot;&quot;&quot;</span>
import os

print('__file__:', __file__)     <span class="comment"># This filename</span>
print('dirname():', os.path.dirname(__file__))  <span class="comment"># directory component (relative or absolute)</span>

print('abspath():', os.path.abspath(__file__))  <span class="comment"># Absolute filename</span>
print('dirname(abspath()):', os.path.dirname(os.path.abspath(__file__))) <span class="comment"># Absolute directory name</span><span class="comment"></span>
</pre>

<p>When a module is loaded in Python, <code>__file__</code> is set to the module name. Try running this script with various <code>__file__</code> references and study their output:</p>

<pre class="command">
<span class="comment"># cd to the directory containing &quot;test_ospath.py&quot;</span>
$ <strong>python3 ./test_ospath.py</strong>
$ <strong>python3 test_ospath.py</strong>
$ <strong>python3 ../<em>parent_dir</em>/test_ospath.py</strong>  <span class="comment"># Relative filename</span>
$ <strong>python3 /<em>path</em>/<em>to</em>/test_ospath.py</strong>       <span class="comment"># Absolute filename</span></pre>

<h5>Handling Symlink (Unixes/macOS)</h5>
<ul>
<li><span class="lead-code">os.path.realpath(<em>path</em>)</span>: (for symlinks) Similar to <code>abspath()</code>, but return the <em>canonical</em> path, eliminating any symlinks encountered.</li>
</ul>

<p>For example,</p>
<pre class="example">
<span class="comment">#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
"""test_realpath.py"""</span>
import os

print('__file__:', __file__)
print('abspath():', os.path.abspath(__file__))  <span class="comment"># Absolute filename</span>
print('realpath():', os.path.realpath(__file__)) <span class="comment"># Filename with symlink resolved, if any</span>
</pre>

<pre class="command">
$ <strong>python3 test_realpath.py</strong>
<span class="output"># Same output for abspath() and realpath() because there is no symlink</span>

<span class="comment"># Make a symlink to the Python script</span>
$ <strong>ln -s test_realpath.py test_realpath_link.py</strong>
<span class="comment"># Run via symlink</span>
$ <strong>python3 test_realpath_link.py</strong>
<span class="output">#abspath(): /path/to/test_realpath_link.py
#realpath(): /path/to/test_realpath.py (symlink resolved)</span></pre>

<h4>Directory &amp; File Management Using Modules <code>os</code> and <code>shutil</code></h4>
<p>The modules <code>os</code> and <code>shutil</code> provide interface to the Operating System and System Shell.</p>
<p>However,</p>
<ul>
<li>If you just want to read or write a file, use built-in function <code>open()</code>.</li>
<li>If you just want to manipulate paths (files, directories and symlinks), use <code>os.path</code> module.</li>
<li>If you want to read all the lines in all the files on the command-line, use <code>fileinput</code> module.</li>
<li>To create temporary files/directories, use <code>tempfile</code> module.</li>
</ul> 

<h5>Directory Management</h5>

<ul>
<li><span class="lead-code">os.getcwd()</span>: Return the current working directory (CWD).</li>

<li><span class="lead-code">os.chdir(<em>dir_path</em>)</span>: Change the CWD.</li>

<li><span class="lead-code">os.mkdir(<em>dir_path</em>, <em>mode</em>=0777)</span>: Create a directory with the given <em><code>mode</code></em> expressed in octal (which will be further masked by environment variable <code>umask</code>). <em><code>mode</code></em> is ignored in Windows.</li>

<li><span class="lead-code">os.mkdirs(<em>dir_path</em>, <em>mode</em>=0777)</span>: Similar to <code>mkdir</code>, but create the intermediate sub-directories, if needed.</li>

<li><span class="lead-code">os.rmdir(<em>dir_path</em>)</span>: Remove an empty directory. You could use <code>os.path.isdir(<em>path</em>)</code> to check if the <code><em>path</em></code> exists.</li>

<li><span class="lead-code">shutil.rmtree(<em>dir_path</em>)</span>: Remove a directory and all its contents.</li>
</ul>

<h5>File Management</h5>
<ul>
<li><span class="lead-code">os.rename(<em>src_file</em>, <em>dest_file</em>)</span>: Rename a file.</li>
<li><span class="lead-code">os.remove(<em>file</em>)</span> or <span class="lead-code">os.unlink(<em>file</em>)</span>: Remove the file. You could use <code>os.path.isfile(<em>file</em>)</code> to check if the <code><em>file</em></code> exists.</li>
</ul>

<p>For examples [TODO],</p>

<pre class="example">
&gt;&gt;&gt; <strong>import os</strong>
&gt;&gt;&gt; <strong>dir(os)</strong>          <span class="comment"># List all attributes</span>
......
&gt;&gt;&gt; <strong>help(os)</strong>         <span class="comment"># Show man page</span>
......
&gt;&gt;&gt; <strong>help(os.getcwd)</strong>  <span class="comment"># Show man page for specific function</span>
......

&gt;&gt;&gt; <strong>os.getcwd()</strong>                   <span class="comment"># Get current working directory</span>
...<em> current working directory </em>...
&gt;&gt;&gt; <strong>os.listdir()</strong>                  <span class="comment"># List the contents of the current directory</span>
... <em>contents of current directory </em>...
&gt;&gt;&gt; <strong>os.chdir('test-python')</strong>       <span class="comment"># Change directory</span>
&gt;&gt;&gt; <strong>exec(open('hello.py').read())</strong> <span class="comment"># Run a Python script</span>
&gt;&gt;&gt; <strong>os.system('ls -l')</strong>            <span class="comment"># Run shell command</span>
&gt;&gt;&gt; <strong>os.name</strong>                       <span class="comment"># Name of OS</span>
'posix'
&gt;&gt;&gt; <strong>os.makedir('<em>sub_dir</em>')</strong>            <span class="comment"># Create sub-directory</span>
&gt;&gt;&gt; <strong>os.makedirs('/path/to/<em>sub_dir</em>')</strong>  <span class="comment"># Create sub-directory and the intermediate directories</span>
&gt;&gt;&gt; <strong>os.remove('<em>file</em>name')</strong>            <span class="comment"># Remove file</span>
&gt;&gt;&gt; <strong>os.rename('<em>oldFile</em>', '<em>newFile</em>')</strong>  <span class="comment"># Rename file</span></pre>


<h5>List a Directory</h5>

<ul>
<li><span class="lead-code">os.listdir(<em>path</em>='.') -&gt; [path]</span>: list all the entries in a given directory (exclude <code>'.'</code> and <code>'..'</code>), default to the current directory.</li>
</ul>

For examples,
<pre class="example">&gt;&gt;&gt; <strong>import os</strong>
&gt;&gt;&gt; <strong>help(os.listdir)</strong>
......
&gt;&gt;&gt; <strong>os.listdir()</strong>    <span class="comment"># Return a list of entries in the current directory</span>
[..., ..., ...]

<span class="comment"># You can use a for-loop to iterate thru the list</span>
&gt;&gt;&gt; <strong>for f in sorted(os.listdir('/usr')): print(f)</strong>
......
&gt;&gt;&gt; <strong>for f in sorted(os.listdir('/usr')): print(os.path.abspath(f))</strong>
......</pre>

<h5>List a Directory Recursively via <code>os.walk()</code></h5>
<ul>
<li><span class="lead-code">os.walk(<em>top</em>, <em>topdown</em>=True, <em>onerror</em>=None, <em>followlinks</em>=False)</span>: recursively list all the entries starting from <code><em>top</em></code>.</li>
</ul>

<p>For example,</p>

<pre><code class="language-python line-numbers">#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
"""
file_list_oswalk.py - List files recursively from a given directory
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Usage: files_list_oswalk.py [&lt;dir&gt;|.]
"""
import sys
import os

def main():
    # Process command-line arguments
    if len(sys.argv) &gt; 2:  # Command-line arguments are kept in a list 'sys.argv'
        print(__doc__)
        sys.exit(1)        # Return a non-zero value to indicate abnormal termination
    elif len(sys.argv) == 2:
        dir = sys.argv[1]  # directory given in command-line argument
    else:
        dir = '.'          # default current directory

    # Verify dir
    if not os.path.isdir(dir):
        print('error: {} does not exists'.format(dir))
        sys.exit(1)

    # Recursively walk thru from dir using os.walk()
    for curr_dir, subdirs, files in os.walk(dir):
        # os.walk() recursively walk thru the given "dir" and its sub-directories
        # For each iteration:
        #    - curr_dir: current directory being walk thru, recursively from "dir"
        #    - subdirs: list of sub-directories in "curr_dir"
        #    - files: list of files/symlinks in "curr_dir"
        print('D:', os.path.abspath(curr_dir))    # print currently walk dir
        for subdir in sorted(subdirs):  # print all subdirs under "curr_dir"
            print('SD:', os.path.abspath(subdir))
        for file in sorted(files):      # print all files under "curr_dir"
            print(os.path.join(os.path.abspath(curr_dir), file))  # full filename

if __name__ == '__main__':
    main()</code></pre>

<h5>List a Directory Recursively via Module <code>glob</code> (Python 3.5)</h5>

<p>[TODO] Intro</p>

<pre><code class="language-python line-numbers">#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
"""
file_list_glob.py - List files recursively from a given directory
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Usage: files_list [&lt;dir&gt;|.]
"""
import sys
import os
import glob  # Python 3.5

def main():
    # Process command-line arguments
    if len(sys.argv) &gt; 2:  # Command-line arguments are kept in a list 'sys.argv'
        print(__doc__)
        sys.exit(1)        # Return a non-zero value to indicate abnormal termination
    elif len(sys.argv) == 2:
        dir = sys.argv[1]  # directory given in command-line argument
    else:
        dir = '.'          # default current directory

    # Check dir
    if not os.path.isdir(dir):
        print('error: {} does not exists'.format(dir))
        sys.exit(1)

    # List *.txt only
    for file in glob.glob(dir + '/**/*.txt', recursive=True):
        # ** match any files and zero or more directories and subdirectories
        print(file)

    print('----------------------------')

    # List all files and subdirs
    for file in glob.glob(dir + '/**', recursive=True):
        # ** match any files and zero or more directories and subdirectories
        if os.path.isdir(file):
            print('D:', file)
        else:
            print(file)

if __name__ == '__main__':
    main()</code></pre>

<h5>Copying File</h5>
<ul>
<li><span class="lead-code">shutil.copyfile(<em>src</em>, <em>dest</em>)</span>: Copy from <code><em>src</em></code> to <code><em>dest</em></code>.</li>
</ul>


<h5>Shell Command [TODO]</h5>
<ul>
<li><span class="lead-code">os.system(<em>command_str</em>)</span>: Run a shell command. (In Python 3, use <code>subprocess.call()</code> instead.)</li>
</ul>

<h5>Environment Variables [TODO]</h5>
<ul>
<li><span class="lead-code">os.getenv(<em>varname</em>, <em>value</em>=None)</span>: Returns the environment variable if it exists, or <code><em>value</em></code> if it doesn't, with default of <code>None</code>.</li>

<li><span class="lead-code">os.putenv(<em>varname</em>, <em>value</em>)</span>: Set environment variable to <em>value</em>.</li>

<li><span class="lead-code">os.unsetenv(<em>varname</em>)</span>: Delete (Unset) the environment variable.</li>
</ul>


<h4><code>fileinput</code> Module</h4>

<p>The <code>fileinput</code> module provides support for processing lines of input from one or more files given in the command-line arguments (<code>sys.argv</code>).  For example, create the following script called &quot;<code>test_fileinput.py</code>&quot;:</p>

<pre class="example">
<span class="comment">#!/usr/bin/env python3
# -*- coding: UTF-8 -*-
&quot;&quot;&quot;
test_fileinput.py: Process all the files given in the command-line arguments
Usage: test_fileinput.py file1, file2, file3, ...
&quot;&quot;&quot;</span>
import fileinput

def main():
    <span class="comment">&quot;&quot;&quot;Get lines from all the file given in the command-line arguments (sys.argv)&quot;&quot;&quot;</span>
    lineNumber = 0
    for line in fileinput.input():
        line = line.rstrip()   <span class="comment"># strip the trailing spaces/newline</span>
        lineNumber += 1
        print('{}: {}'.format(lineNumber, line))

if __name__ == '__main__':
    main()</pre>

<h3>Text Processing</h3>

<p>For simple text string operations such as string search and replacement, you can use the built-in string functions (e.g., <code>str.replace(<em>old</em>, <em>new</em>)</code>). For complex pattern search and replacement, you need to master regular expression (regex).</p>

<h4>String Operations</h4>

<p>The built-in class <code>str</code> provides many member functions for text string manipulation. Suppose that <code><em>s</em></code> is a <code>str</code> object.</p>

<h5>Strip whitespaces (blank, tab and newline)</h5>
<ul>
<li><span class="lead-code"><em>s</em>.strip()-&gt; str</span>: Return a copy of the string <code><em>s</em></code> with leading and trailing whitespaces removed. Whitespaces includes blank, tab and newline.</li>

<li><span class="lead-code"><em>s</em>.strip([chars]) -&gt; str</span>: Strip the leading/trailing characters given, instead of whitespaces.</li>

<li><span class="lead-code"><em>s</em>.rstrip(), <em>s</em>.lstrip() -&gt; str</span>: Strip the right (trailing) whitespaces and the left (leading) whitespaces, respectively. <code>s.rstrip()</code> is the most commonly-used to strip the trailing spaces/newline. The leading whitespaces are usually significant.</li>
</ul>

<h5>Uppercase/Lowercase</h5>
<ul>
<li><span class="lead-code"><em>s</em>.upper(), <em>s</em>.lower() -&gt; str</span>: Return a copy of string <code><em>s</em></code> converted to uppercase and lowercase, respectively.</li>

<li><span class="lead-code"><em>s</em>.isupper(), <em>s</em>.islower() -&gt; bool</span>: Check if the string is uppercase/lowercase, respectively.</li>
</ul>

<h5>Find</h5>
<ul>
<li><span class="lead-code"><em>s</em>.find(<em>key_str</em>, [<em>start</em>], [<em>end</em>]) -&gt; int|-1</span>: Return the lowest index in slice <em><code>s</code></em><code>[<em>start</em>:<em>end</em>]</code> (default to entire string); or -1 if not found.</li>
<li><span class="lead-code"><em>s</em>.index(<em>key_str</em>, [<em>start</em>], [<em>end</em>]) -&gt; int|ValueError</span>: Similar to <code>find()</code>, but raises <code>ValueError</code> if not found.</li>

<li><span class="lead-code"><em>s</em>.startswith(<em>key_str</em>, [<em>start</em>], [<em>end</em>]), <em>s</em>.endsswith(<em>key_str</em>, [<em>start</em>], [<em>end</em>]) -&gt; bool</span>: Check is the string begins or ends with <code><em>key_str</em></code>.</li>
</ul>

<p>For examples,</p>
<pre class="command">
&gt;&gt;&gt; <strong>s = '/test/in.txt'</strong>
&gt;&gt;&gt; <strong>s.find('in')</strong>
6
&gt;&gt;&gt; <strong>s[0 : s.find('in')] + 'out.txt'</strong>
'/test/out.txt'
<span class="comment"># You could use str.replace() described below</span></pre>

<h5>Find and Replace</h5>
<ul>
<li><span class="lead-code"><em>s</em>.replace(<em>old</em>, <em>new</em>, [<em>count</em>]) -&gt; str</span>: Return a copy with all occurrences of <code><em>old</em></code> replaced by <code><em>new</em></code>. The optional parameter <code><em>count</em></code> limits the number of occurrences to replace, default to all occurrences.</li>
</ul>

<p><code>str.replace()</code> is ideal for simple text string replacement, without the need for pattern matching.</p>

<p>For examples,</p>

<pre class="command">
&gt;&gt;&gt; <strong>s = 'hello hello hello, world'</strong>
&gt;&gt;&gt; <strong>help(s.replace)</strong>
&gt;&gt;&gt; <strong>s.replace('ll', '**')</strong>
'he**o he**o he**o, world'
&gt;&gt;&gt; <strong>s.replace('ll', '**', 2)</strong>
'he**o he**o hello, world'</pre>


<h5>Split into Tokens and Join</h5>

<ul>
<li><span class="lead-code"><em>s</em>.split([<em>sep</em>], [<em>maxsplit</em>=-1]) -&gt; [str]</span>: Return a list of words using <code><em>sep</em></code> as delimiter string. The default delimiter is whitespaces (blank, tab and newline). The <code><em>maxSplit</em></code> limits the maximum number of split operations, with default -1 means no limit.</li>

<li><span class="lead-code"><em>sep</em>.join([str]) -&gt; str</span>: Reverse of <code>split()</code>. Join the list of string with <code><em>sep</em></code> as separator.</li>
</ul>

<p>For examples,</p>
<pre class="example">
&gt;&gt;&gt; <strong>'apple, orange, pear'.split()</strong>       <span class="comment"># default delimiter is whitespaces</span>
['apple,', 'orange,', 'pear']
&gt;&gt;&gt; <strong>'apple, orange, pear'.split(', ')</strong>   <span class="comment"># Set the delimiter</span>
['apple', 'orange', 'pear']
&gt;&gt;&gt; <strong>'apple, orange, pear'.split(', ', maxsplit=1)</strong>  <span class="comment"># Set the split operation</span>
['apple', 'orange, pear']

&gt;&gt;&gt; <strong>', '.join(['apple', 'orange, pear'])</strong>
'apple, orange, pear'</pre>


<h4 id="re">Regular Expression in Module <code>re</code></h4>

<p>References:</p>
<ol>
<li>Python's Regular Expression HOWTO @ <a href="https://docs.python.org/3/howto/regex.html">https://docs.python.org/3/howto/regex.html</a>.</li>
<li>Python's re - Regular expression operations @ <a href="https://docs.python.org/3/library/re.html">https://docs.python.org/3/library/re.html</a>.</li>
</ol>

<p>I assume that you are familiar with regex, otherwise, you could read:</p>
<ul>
<li>&quot;<a href="../howto/Regexe.html#byexamples">Regex By Examples</a>&quot; for a summary of regex syntax and examples.</li>
<li>&quot;<a href="../howto/Regexe.html">Regular Expressions</a>&quot; for full coverage.</li>
</ul>

<p>The <code>re</code> module provides support for regular expressions (regex).</p>

<pre class="example">
&gt;&gt;&gt; <strong>import re</strong>
&gt;&gt;&gt; <strong>dir(re)</strong>   <span class="comment"># List all attributes</span>
......
&gt;&gt;&gt; <strong>help(re)</strong>  <span class="comment"># Show man page</span>
......
    <span class="comment"># The man page lists all the special characters and metacharacters used by Python's regex.</span></pre>

<h5>Backslash (<code>\</code>), Python Raw String <code>r'...'</code> vs Regular String</h5>

<p>Regex's syntax uses backslash (<code>\</code>):</p>
<ol>
<li>for <em>metacharacters</em> such as <code>\d</code> (digit), <code>\D</code> (non-digit), <code>\s</code> (space), <code>\S</code> (non-space), <code>\w</code> (word), <code>\W</code> (non-word)</li>
<li>to escape special regex characters, e.g., <code>\.</code> for <code>.</code>, <code>\+</code> for <code>+</code>, <code>\*</code> for <code>*</code>, <code>\?</code> for <code>?</code>. You also need to write <code>\\</code> to match <code>\</code>.</li>
</ol>
<p>On the other hand, Python' regular strings also use backslash for escape sequences, e.g., <code>\n</code> for newline, <code>\t</code> for tab. Again, you need to write <code>\\</code> for <code>\</code>.</p>
<p>To write the regex pattern <code>\d+</code> (one or more digits) in a Python regular string, you need to write <code>'\\d+'</code>. This is cumbersome and error-prone.</p>
<p>Python's solution is using <em>raw string</em> with a prefix <code>r</code> in the form of <code>r'...'</code>. It ignores interpretation of the Python's string escape sequence. For example, <code>r'\n'</code> is <code>'\'+'n'</code> (two characters) instead of newline (one character). Using raw string, you can write <code>r'\d+'</code> for regex pattern <code>\d+</code>  (instead of regular string <code>'\\d+'</code>).</p>
<p> Furthermore, Python denotes parenthesized back references (or capturing groups) as <code>\1</code>, <code>\2</code>, <code>\3</code>, ..., which can be written as raw strings <code>r'\1'</code>, <code>r'\2'</code> instead of regular string <code>'\\1'</code> and <code>'\\2'</code>. Take note that some  languages use <code>$1</code>, <code>$2</code>, ... for the back references.</p>
<p>I suggest that you use raw strings for regex pattern strings and replacement strings.</p>

<h5>Compiling (Creating) a Regex Pattern Object</h5>
<ul>
<li><span class="lead-code">re.compile(<em>regexStr</em>, [<em>modifiers</em>]) -&gt; <em>regexObj</em></span>: Compile a regex pattern into a regex object, which can then be used for matching operations.</li>
</ul>
<p>For examples,</p>
<pre class="example">
&gt;&gt;&gt; <strong>import re</strong>
&gt;&gt;&gt; <strong>p1 = re.compile(r'[1-9][0-9]*|0')</strong>
      <span class="comment"># zero or positive integers (begins with 1-9, followed by zero or more 0-9; or 0)</span>
&gt;&gt;&gt; <strong>type(p1)</strong>
&lt;class '_sre.SRE_Pattern'&gt;

&gt;&gt;&gt; <strong>p2 = re.compile(r'^\w{6,10}$')</strong>
      <span class="comment"># 6-10 word-character line
      # ^ matches the start-of-line, $ matches end-of-line, \w matches word character</span>

&gt;&gt;&gt; <strong>p3 = re.compile(r'xy*', re.IGNORECASE)</strong>   <span class="comment"># with an optional modifier</span>
      <span class="comment"># x followed by zero or more y, case-insensitive</span>
</pre>

<h5>Invoking Regex Operations</h5>

<p>You can invoke most of the regex functions in two ways:</p>
<ol>
<li><span class="lead code"><em>regexObj</em>.<em>func</em>(<em>str</em>)</span>: Apply compiled regex <code><em>object</em></code> to <code><em>str</em></code>, via <code>SRE_Pattern</code>'s member function <code><em>func</em>()</code>.</li>
<li><span class="lead code">re.<em>func</em>(<em>regexObj</em>|<em>regexStr</em>, <em>str</em>)</span>: Apply<em><code> </code></em>regex object (compiled) or <em><code>regexStr</code></em> (uncompiled) to <code><em>str</em></code>, via <code>re</code>'s module-level function <code><em>func</em>()</code>. These module-level functions are shortcuts to the above that do not require you to compile a regex object first, but miss the modifiers if <code><em>regexStr</em></code> is used.</li>
</ol>

<h5>Find using <code>finaAll()</code></h5>

<ul>
<li><span class="lead-code"><em>regexObj</em>.findall(<em>str</em>) -&gt; [str]</span>: Return a list of all the matching substrings.</li>

<li><span class="lead-code">re.findall(<em>regexObj</em>|<em>regexStr</em>, <em>str</em>) -&gt; [str]</span>: same as above.</li>
</ul>

<p>For examples,</p>

<pre class="example">
<span class="comment"># (1) Using compile regex object</span>
&gt;&gt;&gt; <strong>p1 = re.compile(r'[1-9][0-9]*|0')</strong>   <span class="comment"># match integer</span>
&gt;&gt;&gt; <strong>p1.findall('123 456')</strong>
['123', '456']
&gt;&gt;&gt; <strong>p1.findall('abc')</strong>
[]
&gt;&gt;&gt; <strong>p1.findall('abc123xyz456_7_00')</strong>
['123', '456', '7', '0', '0']

<span class="comment"># (2) Using re.findall() with uncompiled regex string</span>
&gt;&gt;&gt; <strong>re.findall(r'[1-9][0-9]*|0', '123 456')</strong>  <span class="comment"># Provide the regex pattern string</span>
['123', '456']
&gt;&gt;&gt; <strong>re.findall(r'[1-9][0-9]*|0', 'abc')</strong>
[]
&gt;&gt;&gt; <strong>re.findall(r'[1-9][0-9]*|0', 'abc123xyz456_7_00')</strong>
['123', '456', '7', '0', '0']</pre>

<h5>Replace using <code>sub()</code> and <code>subn()</code></h5>

<ul>
<li><span class="lead-code"><em>regexObj</em>.sub(<em>replaceStr</em>, <em>inStr</em>, [<em>count</em>=0]) -&gt; <em>outStr</em></span>: Substitute (Replace) the matched substrings in the given <em><code>inStr</code></em> with the <code><em>replaceStr</em></code>, up to <code><em>count</em></code> occurrences, with default of all.</li>

<li><span class="lead-code"><em>regexObj</em>.subn(<em>replaceStr</em>, <em>inStr</em>, [<em>count</em>=0]) -&gt; (<em>outStr</em>, <em>count</em>)</span>: Similar to <code>sub()</code>, but return a new string together with the number of replacements in a 2-tuple.</li>

<li><span class="lead-code">re.sub(<em>regexObj</em>|<em>regexStr</em>, <em>replaceStr</em>, <em>inStr</em>, [<em>count</em>=0]) -&gt; <em>outStr</em></span>: same as above.</li>

<li><span class="lead-code">re.subn(<em>regexObj</em>|<em>regexStr</em>, <em>replaceStr</em>, <em>inStr</em>, [<em>count</em>=0]) -&gt; (<em>outStr</em>, <em>count</em>)</span>: same as above.</li>
</ul>

<p>For examples,</p>

<pre class="example">
<span class="comment"># (1) Using compiled regex object</span>
&gt;&gt;&gt; <strong>p1 = re.compile(r'[1-9][0-9]*|0')</strong>   <span class="comment"># match integer</span>
&gt;&gt;&gt; <strong>p1.sub(r'**', 'abc123xyz456_7_00')</strong>
'abc**xyz**_**_****'
&gt;&gt;&gt; <strong>p1.subn(r'**', 'abc123xyz456_7_00')</strong>
('abc**xyz**_**_****', 5)    <span class="comment"># (outStr, count)</span>
&gt;&gt;&gt; <strong>p1.sub(r'**', 'abc123xyz456_7_00', count=3)</strong>
'abc**xyz**_**_00'

<span class="comment"># (2) Using re module-level function</span>
&gt;&gt;&gt; <strong>re.sub(r'[1-9][0-9]*|0', r'**', 'abc123xyz456_7_00')</strong>  <span class="comment"># Using regexStr</span>
'abc**xyz**_**_****'
&gt;&gt;&gt; <strong>re.sub(p1, r'**', 'abc123xyz456_7_00')</strong>  <span class="comment"># Using pattern object</span>
'abc**xyz**_**_****'
&gt;&gt;&gt; <strong>re.subn(p1, r'**', 'abc123xyz456_7_00', count=3)</strong>
('abc**xyz**_**_00', 3)
&gt;&gt;&gt; <strong>re.subn(p1, r'**', 'abc123xyz456_7_00', count=10)</strong>  <span class="comment"># count exceeds matches</span>
('abc**xyz**_**_****', 5)</pre>

<p><strong>Notes</strong>: For simple string replacement, use <code><em>str</em>.replace(<em>old</em>, <em>new</em>, [<em>max</em>=-1]) -&gt; str</code> which is more efficient. See above section.</p>

<h5>Using Parenthesized Back-References <code>\1</code>, <code>\2</code>, ... in Substitution and Pattern</h5>

<p>In Python, regex parenthesized back-references (capturing groups) are denoted as <code>\1</code>, <code>\2</code>, .... You could use raw string (e.g., <code>r'\1'</code>) to avoid escaping backslash in regular string (e.g., <code>'\\1'</code>).</p>
<p>For examples,</p>

<pre class="example">
<span class="comment"># To swap the two words by using back-references in the replacement string</span>
&gt;&gt;&gt; <strong>re.sub(r'(\w+) (\w+)', r'\2 \1', 'aaa bbb ccc')</strong>
'bbb aaa ccc'
&gt;&gt;&gt; <strong>re.sub(r'(\w+) (\w+)', r'\2 \1', 'aaa bbb ccc ddd')</strong>
'bbb aaa ddd ccc'
&gt;&gt;&gt; <strong>re.subn(r'(\w+) (\w+)', r'\2 \1', 'aaa bbb ccc ddd eee')</strong>
('bbb aaa ddd ccc eee', 2)

<span class="comment"># To remove duplicate words using back-reference</span>
&gt;&gt;&gt; <strong>re.subn(r'(\w+) \1', r'\1', 'hello hello world again again')</strong>
('hello world again', 2)</pre>


<h5>Find using <code>search()</code> and Match Object</h5>

<ul>
<li><span class="lead-code"><em>regexObj</em>.search(<em>inStr</em>, [<em>begin</em>], [<em>end</em>]) -&gt; <em>matchObj</em></span>:</li>

<li><span class="lead-code">re.search(<em>regexObj</em>|<em>regexStr</em>, <em>inStr</em>, [<em>begin</em>], [<em>end</em>]) -&gt; <em>matchObj</em></span>:</li>
</ul>

<p>The <code>search()</code>  returns a special <code>Match</code> object encapsulating the first match (or <code>None</code> if there is no matches). You can then use the following methods to  process the resultant <code>Match</code> object:</p>

<ul>
<li><span class="lead-code"><em>matchObj</em>.group()</span>: Return the matched substring.</li>

<li><span class="lead-code"><em>matchObj</em>.start()</span>: Return the starting matched position (inclusive).</li>

<li><span class="lead-code"><em>matchObj</em>.end()</span>: Return the ending matched position (exclusive).</li>

<li><span class="lead-code"><em>matchObj</em>.span()</span>: Return a tuple of (start, end) matched position.</li>
</ul>

<p>For example,</p>

<pre class="example">
&gt;&gt;&gt; <strong>p1 = re.compile(r'[1-9][0-9]*|0')</strong>
&gt;&gt;&gt; <strong>inStr = 'abc123xyz456_7_00'</strong>
&gt;&gt;&gt; <strong>m = p1.search(inStr)</strong>
&gt;&gt;&gt; <strong>m</strong>
&lt;_sre.SRE_Match object; span=(3, 6), match='123'&gt;
&gt;&gt;&gt; <strong>m.group()</strong>
'123'
&gt;&gt;&gt; <strong>m.span()</strong>
(3, 6)
&gt;&gt;&gt; <strong>m.start()</strong>
3
&gt;&gt;&gt; <strong>m.end()</strong>
6

<span class="comment"># You can search further by providing the begin search positions
# in the form of search(str, [beginIdx]), e.g.,</span>
&gt;&gt;&gt; <strong> m = p1.search(inStr, m.end())</strong>
&gt;&gt;&gt; <strong> m</strong>
&lt;_sre.SRE_Match object; span=(9, 12), match='456'&gt;

<span class="comment"># Using a while loop</span>
&gt;&gt;&gt; <strong>m = p1.search(inStr)</strong>
&gt;&gt;&gt; <strong>while m:</strong>
        <strong>print(m, m.group())</strong>
        <strong>m = p1.search(inStr, m.end())</strong>
&lt;_sre.SRE_Match object; span=(3, 6), match='123'&gt;
123
&lt;_sre.SRE_Match object; span=(9, 12), match='456'&gt;
456
&lt;_sre.SRE_Match object; span=(13, 14), match='7'&gt;
7
&lt;_sre.SRE_Match object; span=(15, 16), match='0'&gt;
0
&lt;_sre.SRE_Match object; span=(16, 17), match='0'&gt;
0</pre>

<p>To retrieve the back-references (or capturing groups) inside the <code>Match</code> object:</p>

<ul>
<li><span class="lead-code"><em>matchObj</em>.groups()</span>: return a tuple of captured groups (or back-references)</li>
<li><span class="lead-code"><em>matchObj</em>.group(<em>n</em>)</span>: return the capturing group <code><em>n</em></code>, where <code><em>n</em></code> starts at <code>1</code>.</li>
<li><span class="lead-code"><em>matchObj</em>.lastindex</span>: last index of the capturing group</li>

</ul>

<pre class="example">
&gt;&gt;&gt; <strong>p2 = re.compile('(A)(\w+)', re.IGNORECASE)</strong>  <span class="comment"># Two parenthesized back-references (capturing groups)</span>
&gt;&gt;&gt; <strong>inStr = 'This is an apple.'</strong>
&gt;&gt;&gt; <strong>m = p2.search(inStr)</strong>
&gt;&gt;&gt; <strong>while m:</strong>
        <strong>print(m)</strong>
        <strong>print(m.group())</strong>    <span class="comment"># show full match</span>
        <strong>print(m.groups())</strong>   <span class="comment"># show capturing groups in tuple</span>
        <strong>for idx in range(1, m.lastindex + 1):</strong>  <span class="comment"># index starts at 1</span>
            <strong>print(m.group(idx), end=',')</strong>   <span class="comment"># show capturing group idx</span>
        <strong>print()</strong>
        <strong>m = p2.search(inStr, m.end())</strong>
&lt;_sre.SRE_Match object; span=(8, 10), match='an'&gt;
an
('a', 'n')
a,n,
&lt;_sre.SRE_Match object; span=(11, 16), match='apple'&gt;
apple
('a', 'pple')
a,pple,</pre>

<h5>Find using <code>match()</code> and <code>fullmatch()</code></h5>

<ul>
<li><span class="lead-code"><em>regexObj</em>.match(<em>inStr</em>, [<em>begin</em>], [<em>end</em>]) -&gt; <em>matchObj</em></span>:</li>

<li><span class="lead-code"><em>regexObj</em>.fullmatch(<em>inStr</em>, [<em>begin</em>], [<em>end</em>]) -&gt; <em>matchObj</em></span>:</li>

<li><span class="lead-code">re.match(<em>regexObj</em>|<em>regexStr</em>, in<em>Str</em>, [<em>begin</em>], [<em>end</em>]) -&gt; <em>matchObj</em></span>:</li>

<li><span class="lead-code">re.fullmatch(<em>regexObj</em>|<em>regexStr</em>, <em>inStr</em>, [<em>begin</em>], [<em>end</em>]) -&gt; <em>matchObj</em></span>:</li>
</ul>



<p>The <code>search()</code> matches anywhere in the given <code><em>inStr</em>[<em>begin</em>:<em>end</em>]</code>. On the other hand, the <code>match()</code> matches <em>from the start</em> of <code><em>inStr</em>[<em>begin</em>:<em>end</em>]</code> (similar to regex pattern <code>^...</code>); while the <code>fullmatch()</code> matches the entire <code><em>inStr</em>[<em>begin</em>:<em>end</em>]</code> (similar to regex pattern <code>^...$</code>).</p>
<p>For example,</p>

<pre class="example">
<span class="comment"># match()</span>
&gt;&gt;&gt; <strong>p1 = re.compile(r'[1-9][0-9]*|0')</strong>   <span class="comment"># match integers</span>
&gt;&gt;&gt; <strong>m = p1.match('aaa123zzz456')</strong>   <span class="comment"># NOT match the beginning 'a...'</span>
&gt;&gt;&gt; <strong>m</strong>
<span class="comment"># None</span>
&gt;&gt;&gt; <strong>m = p1.match('123zzz456')</strong>      <span class="comment"># match the beginning (index 0)</span>
&gt;&gt;&gt; <strong>m</strong>
&lt;_sre.SRE_Match object; span=(0, 3), match='123'&gt;

<span class="comment"># fullmatch()</span>
&gt;&gt;&gt; <strong>m = p1.fullmatch('123456')</strong>     <span class="comment"># Match entire string</span>
&gt;&gt;&gt; <strong>m</strong>
&lt;_sre.SRE_Match object; span=(0, 6), match='123456'&gt;
&gt;&gt;&gt; <strong>m = p1.fullmatch('123456abc')</strong>
&gt;&gt;&gt; <strong>m</strong>
<span class="comment"># None</span></pre>

<h5>Find using <code>finditer()</code></h5>

<ul>
<li><span class="lead-code"><em>regexObj</em>.finditer(<em>inStr</em>) -&gt; <em>matchIterator</em></span></li>

<li><span class="lead-code">re.finditer(<em>regexObj</em>|<em>regexStr</em>, <em></em><em>inStr</em>) -&gt; <em>matchIterator</em></span></li>
</ul>

<p>The <code>finditer()</code> is similar to <code>findall()</code>. The <code>findall()</code> returns a list of matched substrings. The <code>finditer()</code> returns an iterator to <code>Match</code> objects. For examples,</p>

<pre class="example">
<span class="comment"># Using findall()</span>
&gt;&gt;&gt; <strong>p1 = re.compile(r'[1-9][0-9]*|0')</strong>
&gt;&gt;&gt; <strong>inStr = 'abc123xyz456_7_00'</strong>
&gt;&gt;&gt; <strong>p1.findall(inStr)</strong>   <span class="comment"># return a list of matched substrings</span>
['123', '456', '7', '0', '0']
&gt;&gt;&gt; <strong>for s in p1.findall(inStr):</strong>  <span class="comment"># using for-in loop to process the list</span>
        <strong>print(s, end=' ')</strong>
123 456 7 0 0

<span class="comment"># Using finditer()</span>
&gt;&gt;&gt; <strong>for m in p1.finditer(inStr):</strong>  <span class="comment"># using loop on iterator</span>
        <strong>print(m)</strong>
&lt;_sre.SRE_Match object; span=(3, 6), match='123'&gt;
&lt;_sre.SRE_Match object; span=(9, 12), match='456'&gt;
&lt;_sre.SRE_Match object; span=(13, 14), match='7'&gt;
&lt;_sre.SRE_Match object; span=(15, 16), match='0'&gt;
&lt;_sre.SRE_Match object; span=(16, 17), match='0'&gt;

&gt;&gt;&gt; <strong>for m in p1.finditer(inStr):</strong>
        <strong>print(m.group(), end=' ')</strong>
123 456 7 0 0</pre>

<h5>Splitting String into Tokens</h5>

<ul>
<li><span class="lead-code"><em>regexObj</em>.split(<em>inStr</em>) -&gt; [str]</span>:</li>
<li><span class="lead-code">re.split(<em>regexObj</em>|<em>regexStr</em>, <em>inStr</em>) -&gt; [str]</span>:</li>
</ul>

<p>The <code>split()</code> splits the given <code><em>inStr</em></code> into a <code>list</code>, using the regex's <code>Pattern</code> as delimiter (separator). For example,</p>

<pre class="example">
&gt;&gt;&gt; <strong>p1 = re.compile(r'[1-9][0-9]*|0')</strong>
&gt;&gt;&gt; <strong>p1.split('aaa123bbb456ccc')</strong>
['aaa', 'bbb', 'ccc']

&gt;&gt;&gt; <strong>re.split(r'[1-9][0-9]*|0', 'aaa123bbb456ccc')</strong>
['aaa', 'bbb', 'ccc']</pre>

<p><strong>Notes</strong>: For simple delimiter, use <code><em>str</em>.split([<em>sep</em>])</code>, which is more efficient. See above section.</p>

<h3>Web Scraping</h3>

<h5>References:</h5>
<ol>
<li>Beautiful Soup Documentation @ <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">https://www.crummy.com/software/BeautifulSoup/bs4/doc/</a>.</li>
</ol>

<p>Web Scraping (or web harvesting or web data extraction) refers to reading the raw HTML page to retrieve desired data. Needless to say, you need to  master HTML, CSS and JavaScript.</p>

<p>Python supports web scraping via packages requests and BeautifulSoup (bs4).</p>

<h5>Install Packages</h5>

<p>You could install the relevant packages using <code>pip</code> as follows:</p>
<pre class="command">
$ pip install requests
$ pip install bs4</pre>

<h5>Step 0: Inspect the Target Webpage</h5>

<ol>
<li>Press F12 on the target webpage to turn on the &quot;F12 debugger&quot;.</li>
<li>Choose &quot;Inspector&quot;.</li>
<li>Click the &quot;Select&quot;  (the left-most icon with a arrow) and point your mouse at the desired part of the HTML page. Study the codes.</li>
</ol>

<h5>Step 1: Send a HTTP GET request to the target URL to retrieve the raw HTML page using module <code>requests</code></h5>

<pre class="command">
&gt;&gt;&gt; <strong>import requests</strong>
<span class="comment">
# Set the target URL</span>
&gt;&gt;&gt; <strong>url = &quot;http://your_target_webpage&quot;</strong>

<span class="comment"># Send a HTTP GET request to the target URL to retrieve the HTML page,
# which returns a &quot;Response&quot; object.</span>
&gt;&gt;&gt; <strong>response = requests.get(url)</strong>
<span class="comment">
# Inspect the &quot;Response' object</span>
&gt;&gt;&gt; <strong>type(response)</strong>
&lt;class 'requests.models.Response'&gt;
&gt;&gt;&gt; <strong>response</strong>
&lt;Response [200]&gt;
&gt;&gt;&gt; <strong>help(response)</strong>
......
&gt;&gt;&gt; <strong>print(response.text)</strong>     <span class="comment"># content of the response, in unicode text</span>
......
&gt;&gt;&gt; <strong>print(response.content)</strong>  <span class="comment"># content of the response, in raw bytes</span>
......</pre>

<h5>Step 2: Parse the HTML Text into a Tree-Structure using <code>BeautifulSoup</code> and Search the Desired Data</h5>

<pre class="command">
<span class="comment"># Continue from Step 1</span>
&gt;&gt;&gt; <strong>from bs4 import BeautifulSoup</strong>

<span class="comment"># Parse the HTML text into a tree-structure &quot;BeautifulSoup&quot; object</span>
&gt;&gt;&gt; <strong>soup = BeautifulSoup(response.text, &quot;html.parser&quot;)</strong>

<span class="comment"># Inspect the &quot;BeautifulSoup&quot; object</span>
&gt;&gt;&gt; <strong>type(soup)</strong>
&lt;class 'bs4.BeautifulSoup'&gt;
&gt;&gt;&gt; <strong>help(soup)</strong>
......
<span class="comment">
# Find the first appearance a particular HTML tag (e.g, 'img') via find(tag) -&gt; str</span>
&gt;&gt;&gt; <strong>img_tag = soup.find('img')</strong>
&gt;&gt;&gt; <strong>img_tag</strong>
&lt;img ...... /&gt;
<span class="comment">
# Find all the appearances of a particular tag, via findAll(tag) -&gt; [str]</span>
&gt;&gt;&gt; <strong>img_tags = soup.findAll('img')</strong>
&gt;&gt;&gt; <strong>img_tags</strong>
[&lt;img ... /&gt;, &lt;img ... /&gt;, &lt;img ... /&gt;, ...]

<span class="comment"># Find the first appearance of a tag with certain attributes</span>
&gt;&gt;&gt; <strong>soup.find('div', attrs = {'id':'test'})</strong>
<span class="comment"># Find all appearances of a tag with certain attributes</span>
&gt;&gt;&gt; <strong>soup.findAll('div', attrs = {'class':'error'})</strong>
</pre>

<p>You could write out the selected data to a file:</p>
<pre class="command">
<strong>with open(filename, 'w') as fp:
    for row in rows:
        fp.write(row + '\n')</strong></pre>

<p>You could also use <code>csv</code> module to write out rows of data with a header:</p>
<pre class="command">
&gt;&gt;&gt; <strong>import csv</strong>
&gt;&gt;&gt; <strong>with open(filename, 'w') as fp:
        writer = csv.DictWriter(fp, ['colHeader1', 'colHeader2', 'colHeader3'])
        writer.writeheader()
        for row in rows:
            writer.writerow(row)</strong></pre>

<h5>Step 3: Download Selected Document Using <code>urllib.request</code></h5>

<p>You may want to download documents such as text files or images.</p>

<pre class="command"><span class="comment"># Continue from Step 2</span>
&gt;&gt;&gt; <strong>import urllib.request</strong>
<span class="comment"># Download a select URL and save the response in a local file</span>
&gt;&gt;&gt; <strong>downloadUrl = '.....'</strong>
&gt;&gt;&gt; <strong>file = '......'</strong>
&gt;&gt;&gt; <strong>urllib.request.urlretrieve(download_url, file)</strong></pre>

<h5>Step 4: Delay</h5>

<p>To avoid spamming a website with download requests (and flagged as a spammer), you need to pause your code for a while.</p>

<pre class="command">
&gt;&gt;&gt; <strong>import time</strong>
<span class="comment"># Pause (in seconds)</span>
&gt;&gt;&gt; <strong>time.sleep(1)</strong></pre>

<!-- @@ start change in v1 -->
<p class="references">REFERENCES &amp; RESOURCES</p>

</div> <!-- End the content-main division -->

<div id="content-footer">
<p>Latest version tested: Python 3.11<br />
Last modified: May, 2023</p>
</div>

</div>  <!-- End the wrap-inner division -->

<!-- @@ v3 footer changes starts here, before "footer", to end of document -->
<!-- footer filled by JavaScript -->
<div id="footer" class="footer"><p>&nbsp;</p></div>

</div>  <!-- End the wrap-outer division -->

<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<!-- My custom JavaScript v3 -->
<script src="../scripts/programming_notes_v3.js"></script>
<!-- Prism Syntax Highlighter -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>
