<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!-- for responsive web design -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- for SEO -->
<meta name="description" content="Blockchain, Bitcoin and Smart Contract">
<meta name="keywords" content="Blockchain, Bitcoin and Ethereum">
<title>Smart Contract in Ethereum Blockchain</title>

<!-- ===================================================================== -->



<!-- @@ v3 header changes starts here after <title> -->
<!-- My custom CSS v3 -->
<link rel="stylesheet" href="../css/programming_notes_v3.css">
<!-- Prism Syntax Highlighter -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-highlight/prism-line-highlight.min.css" rel="stylesheet" />
<!-- favicon -->
<link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
</head>

<body>

<div id="wrap-outer">

<!-- header filled by JavaScript -->
<div id="header" class="header"><p>&nbsp;</p></div>

<div id="wrap-inner">

<div id="wrap-toc">
<h5>Table of Contents <a id="show-toc" href="ethereum.html#show-toc">(Hide)</a></h5>
<div id="toc"></div>  <!-- for showing the "Table of Content" -->
</div>

<!-- @@ v3 header changes ends here before "content-header" <h1> and <h2>"" -->

	
<!-- ===================================================================== -->
<div id="content-header">
<h1>Writing Smart Contracts in Ethereum Blockchain</h1>
<h2>&nbsp;</h2>
</div>

<div id="content-main">

<!-- @@ end change in v1 -->

<p>To program Ethereum blockchain, you need to be familiar with JavaScript and full-stack web development under Node.js.</p>

<h3>Introduction to Blockchain Technology [TODO]</h3>

<p>A blockchain is a <em>distributed digital ledger of transactions</em>. It contains records of all transactions or events that have been executed, which are shared across the nodes participating in the blockchain.</p>
<p>A blockchain is segregated into blocks. Each block contains encrypted data on the transaction, sender/receiver, and the previous block's hash. The block is then appended to the chain in chronological order, hence, the name blockchain.</p>
<p>Blockchain is immutable and trusted ...</p>
<p>Blockchain is distributed, peer-to-peer, decentralized, not controlled by an single party, no intermediary to verify.</p>

<h4>Consensus algorithms</h4>
	
<h5>Proof of Work (PoW)</h5>
<p>&quot;Proof of work (PoW) is a form of cryptographic proof in which one party (the prover) proves to others (the verifiers) that a certain amount of a specific computational effort has been expended. Verifiers can subsequently confirm this expenditure with minimal effort on their part.&quot;</p>
<p>PoW was  popularized by Bitcoin as a foundation for consensus in a permissionless decentralized network. To create new block, it will require miners to compete to solve a mathematical puzzle which requires a lot of computational power. The first node who solves the puzzle gets to mine the next block.</p>
	
<h5>Proof of Stake (PoS)</h5>
<p>PoS is based on the number of blocks owned by the node. Validators use some of their own coins as stakes. Validators will validate blocks by placing a bet on it if they discover a block which they think can be added to the chain. To entice the validators, rewards are given based on their bet. As their bet increases so will their reward. In the end, a validator is chosen to generate a new block based on their economic stake in the network.</p>

<h5>Proof of Authority (PoA)</h5>
<p>Some nodes (or moderators) are given the authority to validate transaction.</p>
<p>&quot;Proof of authority (PoA) is an algorithm used with blockchains that delivers comparatively fast transactions through a consensus mechanism based on identity as a stake. The most notable platforms using PoA are VeChain, Bitgert, Palm Network and Xodex.&quot;</p>

<h5>Comparison</h5>
<table class="table-zebra" style="width:90%">
<tr>
  <th width="33%">Proof of Work (PoW)<br>e.g., Bitcoin</th>
  <th width="33%">Proof of Stake (PoS)<br>e.g., Ethereum</th>
  <th width="33%">Proof of Authority (PoA)</th>
</tr>
<tr>
  <td>
	<ul>
	  <li>Nodes are called miners</li>
	  <li>Mining capacity depends on the computing power</li>
	  <li>Mining produces new block (i.e., new coin)</li>
	  <li>Miner receives the new block produced as reward and (may be) transaction fee</li>
	  <li>Not energy efficient</li>
	  <li>prone to 51% attack</li>
	  <li>Peer-to-peer (P2P) - no central authority</li>
	</ul>
  </td>
  <td>
	<ul>
	  <li>Nodes are called validators (or forgers)</li>
	  <li>Capacity depends on the stack (the number of blocks owned)</li>
	  <li>No new block produced</li>
	  <li>No mining incentive but receive transaction fee as reward</li>
	  <li>Low/moderate energy consumption</li>
	  <li>No 51% attack</li>
	  <li>Public blockchain</li>
	</ul>
  </td>
  <td>
	<ul>
	  <li>Based on identity of nodes</li>
	  <li>Relied on a limited number of validators</li>
	  <li>Private blockchain</li>
	  <li>No reward</li>
	  <li>High performance</li>
	</ul>
  </td>
</tr>
</table>

	
<h4>History of Blockchain</h4>
<p>In November 1, 2008, Satoshi Nakamoto, who remains anonymous to-date, published the famous &quot;Bitcoin White Paper&quot; (<a href="https://bitcoin.org/bitcoin.pdf">https://bitcoin.org/bitcoin.pdf</a>) and created the cryptocurrency Bitcoin.</p>

<h3 id="EthereumExamples">Building Smart Contract in Ethereum Blockchain by Examples</h3>
<h5>References:</h5>
<ol>
<li>Ethereum @ <a href="https://ethereum.org/">https://ethereum.org/</a>.</li>
<li>Truffle Boxes - The easier way to get started @ <a href="https://www.trufflesuite.com/boxes">https://www.trufflesuite.com/boxes</a>.</li>
</ol>

<h4 id="WhatIsBlockChain">What is Ethereum Blockchain? [Work In Progress]</h4>

<p>There are several blockchain platforms that allow developers to create and execute smart contracts. Ethereum (@ <a href="https://ethereum.org/">https://ethereum.org/</a>) is a global, open-source platform for decentralized applications (dapps). Launched in 2015, Ethereum is among the leading <em>programmable</em> blockchains that you can use it to build new blockchain applications, such as cryptocurrency wallets, financial applications, decentralized markets, and games. Like other blockchains, Ethereum has a native cryptocurrency called Ether (ETH), similar to Bitcoin.</p>

<p>Ethereum consists of:</p>
<ol>
<li>Ethereum Virtual Machine (EVM): essentially a state machine that allows you to execute codes.</li>
<li>Solidity: a programming language build on top of the EVM for writing smart contracts, to send and receive digital tokens and store states.</li>
<li>Gas: On the Ethereum blockchain, each smart contract is processed by one miner and the resultant block is added to the blockchain. Miners must be rewarded for their efforts, so executing any smart contract on the EVM requires a payment called <em>gas</em>. You need to specify the amount of gas you want to spend for executing any smart contract you create.</li>
</ol>

<p>To transact on Ethereum blockchain, a user needs an account with a wallet address having some Ether (ETH). Once he connected to the network, he can execute transaction and pay a small transaction fee to write his transaction to the blockchain. This transaction fee is called &quot;gas&quot;. Some of the nodes on the network, called miners, compete to complete this transaction. The miner who completes this transaction is awarded the Ether.</p>
<p>It is important to note that reading data from the blockchain is free, but writing to it is not.</p>

<h5>Bitcoin vs. Ethereum</h5>
<p>[Work In Progress]</p>

<p>Bitcoin offers one application of blockchain technology, a peer-to-peer electronic cash system that enables online Bitcoin payments. Ethereum leverages on blockchain with the implementation of smart contracts.</p>

<p>In the Ethereum blockchain, users use a crypto token known as Ether which fuels the network. Unlike Bitcoin where it is mainly a tradeable cryptocurrency, Ether is also used to pay for transaction fees and services by application developers on the Ethereum network.</p>

<p>In the Ethereum blockchain there is also another type of token known as gas, that is used to pay miners fees for including transactions in their block and every smart contract execution requires a certain amount of gas to be sent along with it to entice miners to put it in the blockchain.</p>




<h4 id="WhatIsSmartContract">What is a Smart Contract?</h4>
<p>The Ethereum blockchain allows us to execute code containing in smart contracts with the Ethereum Virtual Machine (EVM).</p>
<p>Smart contracts contain the business logic of our dapp. There are in charge of reading from and writing to the Ethereum blockchain. Smart contacts are written in a programming language called Solidity, which looks like JavaScript.</p>
<h4 id="EthereumTools">Tools</h4>

<img class="image-center" src="images/DappFrameworks.png" alt="dapp framework" />

<p>To develop an Ethereum smart contract for a blockchain marketplace, you need to install following toolkits:</p>

<h5 id="InstallNodeNPM">Node.js and npm (@ <a href="https://nodejs.org/">https://nodejs.org/</a>) - JavaScript Runtime and Package Manager</h5>

<p>Node.js is a <em>JavaScript runtime environment</em> that executes JavaScript code outside of a browser. It is open-source and cross platform.</p>
<p>npm (originally short for Node Package Manager) is a <em>package manager</em> for the JavaScript and node.js. It consists of a command-line client, also called <code>npm</code>, and a registry of packages.</p>

<p>To install node.js and npm: Goto node.js download site @ <a href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a> &rArr; choose &quot;LTS&quot; (Long-Term Support).</p>

<ul>
<li>(Windows) select &quot;Windows Binary (.zip), 64-bit&quot; to download the ZIP file (e.g., &quot;node-v12.16.1-win-x64.zip&quot;) &rArr; Unzip into an installed directory of your choice  &rArr; Add the installed directory to your PATH environment variable &rArr; the executables &quot;<code>node.exe</code>&quot; and &quot;<code>npm.cmd</code>&quot; can be found at the installed directory (accessible via PATH).</li>
<li>(macOS): TODO</li>
<li>(Linux): TODO</li>
</ul>

<p>To verify, issue the following commands from CMD/Terminal/Bash-Shell:</p>

<pre class="command">
<strong>node -v</strong>
<span class="color-output">v12.16.1</span>

<strong>npm -v</strong>
<span class="color-output">6.13.4</span></pre>



<h5 id="InstallTruffle">Truffle Suite (@ <a href="https://www.trufflesuite.com/">https://www.trufflesuite.com/</a>) - A Development Framework for Ethereum Blockchain Applications</h5>
<p>The Truffle Suite allows us to build decentralized applications (dapps) on the Ethereum blockchain. It provides a suite of tools for us to <em>write</em> smart contracts with the solidity language, <em>test</em> the smart contracts and <em>deploy</em> them to the blockchain.</p>

<p>You can install Truffle with npm as follows. Global option is used so that it can be used in many projects.</p>
<pre class="command">
<strong>npm install --global truffle</strong>
</pre>

<p>To verify:</p>
<pre class="command">
<strong>truffle version</strong>
<span class="color-output">Truffle v5.1.15 (core: 5.1.15)
Solidity v0.5.16 (solc-js)
Node v12.16.1
Web3.js v1.2.1</span></pre>

<p>Truffle module is installed under &quot;<code>node_modules</code>&quot; sub-directory of node.js installed directory. The executable &quot;<code>truffle.cmd</code>&quot; can be found at the node.js base directory.</p>

<p>Truffle comes with a set of <em>commands</em>, the commonly-used commands are listed below via &quot;<code>truffle help</code>&quot;:</p>
<pre class="command">
<strong>truffle help</strong>
<span class="color-output">Truffle v5.1.15 - a development framework for Ethereum
Usage: truffle &lt;command&gt; [options]
<strong>compile</strong>   Compile contract source files
<strong>console</strong>   Run a console with contract abstractions and commands available
<strong>migrate</strong>   Run migrations to deploy contracts
<strong>test</strong>      Run JavaScript and Solidity tests
<strong>unbox</strong>     Download a Truffle Box, a pre-built Truffle project
<strong>version</strong>   Show version number and exit
......</span></pre>

<h5 id="InstallGanache">Ganache (@ <a href="https://www.trufflesuite.com/ganache">https://www.trufflesuite.com/ganache</a>) - A Local Personal Blockchain for Ethereum Development</h5>
<p>Ganache is a local in-memory personal blockchain, which you can use to run tests, execute commands, and inspect state while controlling how the chain operates.</p>
<p>To install Ganache: Goto Truffle-Ganache @ <a href="https://www.trufflesuite.com/ganache">https://www.trufflesuite.com/ganache</a> &rArr; Download.</p>

<p>Ganache provides 10 accounts preloaded with 100 <em>fake</em> Ether (ETH). Each account has a unique address and a private key.</p>

<h5 id="InstallWeb3">web3.js (@ <a href="https://web3js.readthedocs.io/">https://web3js.readthedocs.io/</a> and <a href="https://github.com/ethereum/web3.js/">https://github.com/ethereum/web3.js/</a>)</h5>

<p>The traditional front-end client written in HTML/CSS/JavaScript connects and interacts with a backend HTTP server. On the other hand, the smart contract client needs to connect to a Ethereum blockchain node.</p>

<p>Web3.js is the Ethereum JavaScript API that let you interacts with  Ethereum blockchain nodes, local or remote, using a HTTP or IPC (Inter-Process Call) connection. It can retrieve user accounts, send transactions, interact with smart contracts, and more.</p>

<h5 id="InstallMetaMask">MetaMask Wallet (@ <a href="https://metamask.io/">https://metamask.io/</a>)</h5>

<p>MetaMask is a crypto wallet and gateway to blockchain dapps. It is available as a browser extension (for Chrome and Firefox) and as a mobile app. It equips you with a key vault, secure login and token wallet - everything you need to manage your digital assets.</p>

<ul>
<li>(For Firefox) Select &quot;Settings&quot; &rArr; &quot;Add-ons&quot; &rArr; Search for &quot;MetaMask&quot; &rArr; Select &quot;Meta&lt;ask (Ethereum Browser Extension)&quot; &rArr; &quot;Add to Firefox&quot; &rArr; You will see a &quot;Fox&quot; icon appears on the top-right of navigation bar.</li>
<li>(For Chrome) Goto &quot;Settings&quot; &rArr; &quot;Extensions&quot; &rArr; &quot;Open Chrome Web Store&quot; &rArr; Search for &quot;MetaMask&quot; &rArr; &quot;Add to Chrome&quot; &rArr; You will see a &quot;Fox&quot; icon appears on the top-right of navigation bar.</li>
</ul>

<p>Other alternative wallets are: EtherWallet...</p>

<h5>Lite-Server (@ <a href="https://github.com/johnpapa/lite-server">https://github.com/johnpapa/lite-server</a>) - A Light-weight HTTP server</h5>
<p>Bundled with Truffle Box.</p>

<h5>Gulp (@ <a href="https://gulpjs.com/">https://gulpjs.com/</a>) - A Task Runner (Build Tool) to Automate the Work Flow</h5>
<p>[TODO]</p>


<h5 id="InstallEditor">Source-Code Editor or Integrated Development Environment (IDE)</h5>

<p>You can use a source-code editor to start learning Ethereum, but a good IDE will greatly improve your productivity.</p>

<p>Many source-code editor and IDE provide support for Ethereum Solidity programming language.</p>
<ul>
<li>VS Code (Microsoft Visual Studio Code) (@ <a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a>): To install support for Solidity &rArr; Select &quot;Extensions&quot; &rArr; Search &quot;Solidity&quot; &rArr; Choose &quot;Solidity (Solidity support for Visual Studio Code&quot;.</li>
<li>Sublime Text 3 (Source-Code Editor) (@ <a href="https://www.sublimetext.com/">https://www.sublimetext.com/</a>): To install support for Solidity &rArr; Select &quot;Preferences&quot; &rArr; Package control &rArr; Enter &quot;Install Package&quot; &rArr; Enter &quot;Ethereum&quot; &rArr; Restart.</li>
<li>Remix - Ethereum IDE (@ <a href="https://remix.ethereum.org/">https://remix.ethereum.org/</a>): an online editor for instant testing and deployment.</li>
<li>Ethereum Studio - Solidity IDE (@ <a href="https://studio.ethereum.org/">https://studio.ethereum.org/</a>): [TODO]</li>
</ul>

<h4 id="TruffleBox">Truffle Box</h4>

<p>Truffle box (@ <a href="https://www.trufflesuite.com/boxes">https://www.trufflesuite.com/boxes</a>) provides many boilerplate for you to develop your dapp.</p>


<h4 id="ExamplePetShop">Example 1: First Dapp with Truffle Box Pet-Shop</h4>

<h5>References:</h5>
<ol>
<li>Josh Quintal, &quot;Ethereum Pet Shop Tutorial - Your First Dapp&quot; @ <a href="https://www.trufflesuite.com/tutorials/pet-shop">https://www.trufflesuite.com/tutorials/pet-shop</a>.</li>
<li>Truffle Box Pet-Shop @ <a href="https://www.trufflesuite.com/boxes/pet-shop">https://www.trufflesuite.com/boxes/pet-shop</a>.</li>
</ol>

<p>&nbsp;</p>
<p>We shall begin with the Truffle Box &quot;Pet Shop&quot; as our first dapp example (following the tutorial in the references).</p>
<h5>Step 1: Create a Truffle Project</h5>
<p>First, let us create a project directory called &quot;<code>petshop</code>&quot;.</p>
<p>Start a CMD/Terminal/Bash-Shell and issue these commands:</p>
<pre class="command">
<strong><span class="color-comment">// cd /<em>path</em>/<em>to</em>/<em>base-directory</em></span>
mkdir petshop
cd petshop</strong></pre>

<h5>Step 2: Unbox the Pet-Shop Truffle Box into our Project Directory</h5>

<p>Download and unpack the Truffle box Pet-Shop:</p>
<pre class="command">
<span class="color-comment"><strong>// cd /<em>path</em>/<em>to</em>/petshop</strong></span>
<strong>truffle unbox pet-shop</strong>
<span class="color-output">......
Unbox successful, sweet!
Commands:
  Compile:        truffle compile
  Migrate:        truffle migrate
  Test contracts: truffle test
  Run dev server: npm run dev</span></pre>

<p>The boilerplate codes are unpacked into the &quot;<code>petshop</code>&quot; directory created earlier.</p>

<p>The  Truffle's directory structure contains:</p>
<ul>
<li><code>contracts/</code>: contains the solidity source file (<code>.sol</code>) for smart contracts. The Pet-Shop box provides a smart contract called &quot;<code>Migrations.sol</code>&quot; used for deployment.</li>
<li><code>migrations/</code>: Truffle uses a migration system to deploy smart contracts. A <code>Migration</code> is a special smart contract that keeps track of changes.</li>
<li><code>test/</code>: contains the test scripts (written in JavaScript or Solidity) for the smart contracts.</li>
<li><code>node_modules/</code>: contains the node.js dependencies.</li>
<li><code>src/</code>: contains client-side programs in HTML/CSS/JS and  related resources such as images and fonts.</li>
<li><code>truffle-config.js</code>: the Truffle configuration file.</li>
</ul>

<h5>Step 3: Write our Smart Contract</h5>
<p>We shall begin writing our smart contract. A smart contract contains the business logic and is in charge of reading from and writing to the Ethereum blockchain.</p>

<p>Use a source-code editor or IDE, create the following Solidity source file, and save as &quot;<code>Adoption.sol</code>&quot; under the &quot;<code>contracts</code>&quot; directory.</p>

<table class="table-program">
<col class="col-line-number" />
<col class="col-program" />
<tbody>
<tr>
<td>
<pre class="text-right">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
</td>
<td>
<pre>
pragma solidity ^0.5.0;

contract <strong>Adoption</strong> {
    <span class="color-comment">// Declare an array of 16 Ethereum addresses as the adopter of each pet</span>
    address[16] public adopters;

    <span class="color-comment">// Adopting a pet</span>
    function adopt(uint petId) public returns (uint) {
        require(petId &gt;= 0 &amp;&amp; petId &lt;= 15, &quot;Pet-ID out of range&quot;);
        adopters[petId] = msg.sender;  <span class="color-comment">// address of account/smart contract that calls this function</span>
        return petId;
    }

    <span class="color-comment">// Retrieving the adopters</span>
    function getAdopters() public view returns (address[16] memory) {
        return adopters;
    }
}</pre>
</td>
</tr>
</tbody>
</table>

<p>Dissecting the code:</p>
<ol>
<li>In Line 1, the <code>progma</code> statement, which provides additional information to the compiler, is used to specify the Solidity version. The caret (<code>^</code>) denotes minimum version of <code>0.5.0</code>, but lower than the next version of <code>0.6</code>.</li>
<li>Statements are terminated by a semicolon (<code>;</code>). By convention, a contract name begins with an uppercase letter; and the variables/functions begins with a lowercase.</li>

<li>Variable <code>adopters</code>: In Line 5, we declare a <code>public</code> variable called <code>adopters</code>, which is an array of <code>address</code>.
  <ol>
  <li>Solidity has a type called <code>address</code>, which holds an Ethereum 20-byte address. Every account and smart contract on the Ethereum blockchain has a unique address and can send and receive Ether (ETH) to and from this address.</li>
    <li>Public variables in solidity have automatic getter methods. For an array, the getter method is <code>.adopters(idx)</code> for retrieving individual element.</li>
  </ol>
</li>
<li>Function <code>adopt()</code>: In Line 8, we define our business logic function called <code>.adopt()</code>, specifying the parameters and return-type.
  <ol>
  <li>In Line 9, the <code>require(condition, errMsg)</code> checks for the validity.</li>
  <li>In Line 10, we set the <code>adopters[idx]</code> to the <code>address</code> of the caller of this function. The <code>address</code> of an account or a smart contract who called this function is given by <code>msg.sender</code>.</li>
  </ol>
</li>

<li>Function <code>getAdopters()</code>: In Line 15, we define a function called <code>.getAdopters()</code> to return the <code>adopters</code> <code>address</code> array.
<ol>
<li>The return type is specified as <code>address[16] memory</code>. The <code>memory</code> gives the data location for the variable.</li>

<li>The <code>view</code> keyword specifies that the function will not modify the state of the contract.</li>
</ol></li>
</ol>

<h5>Step 4: Compile the Smart Contract</h5>
<p>We can compile the smart contracts using Truffle. Start a CMD/Terminal, and issue this command:</p>
<pre class="command">
<span class="color-comment"><strong>// cd /<em>path</em>/<em>to</em>/petshop</strong></span>
<strong>truffle compile</strong>
&gt; Compiling .\contracts\<span class="color-new">Adoption.sol</span>
&gt; Compiling .\contracts\<span class="color-new">Migrations.sol</span><br>&gt; Artifacts written to ...\<span class="color-new">petshop\build\contracts</span>
&gt; Compiled successfully using:
   - <span class="color-new">solc: 0.5.16</span>+commit.9c3226ce.Emscripten.clang</pre>

<p>The outputs are Artifacts &quot;<code>Adoption.json</code>&quot; and &quot;<code>Migrations.json</code>&quot;, kept in &quot;<code>petshop/build/contracts/</code>&quot; directory.</p>

<h5>Step 5: Migrate to the Ganache Local Personal Blockchain</h5>
<p>A <code>Migration</code> is a deployment script meant to alter the state of our application's contracts, moving it from one state to the next. For the first migration, we just deploy new code, but over time, other migrations might move data around or replace a contract with a new one.</p>
<p>In the &quot;<code>Migrations</code>&quot; directory, there is currently a JavaScript called &quot;<code>1_initial_migration.js</code>&quot;, as follows, which deploys the &quot;<code>contracts/Migrations.sol</code>&quot;.</p>

<table class="table-program">
<col class="col-line-number" />
<col class="col-program" />
<tbody>
<tr>
<td>
<pre class="text-right">1
2
3
4
5</pre>
</td>
<td>
<pre>
var <span class="color-new">Migrations</span> = artifacts.require(&quot;./<span class="color-new">Migrations.sol</span>&quot;);

module.exports = function(deployer) {
  deployer.deploy(<span class="color-new">Migrations</span>);
};</pre>
</td>
</tr>
</tbody>
</table>

<p>The &quot;<code>Migrations.sol</code>&quot; smart contract is re-produced as follows:</p>

<table class="table-program">
<col class="col-line-number" />
<col class="col-program" />
<tbody>
<tr>
<td>
<pre class="text-right">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
</td>
<td>
<pre>
pragma solidity &gt;=0.4.21 &lt;0.7.0;

contract <strong>Migrations</strong> {
  address public owner;
  uint public last_completed_migration;

  modifier restricted() {
    if (msg.sender == owner) _;
  }

  constructor() public {
    owner = msg.sender;
  }

  function setCompleted(uint completed) public restricted {
    last_completed_migration = completed;
  }
}</pre>
</td>
</tr>
</tbody>
</table>


<p>Create the second migration script called &quot;<code>2_deploy_contracts.js</code>&quot; in the &quot;<code>Migrations</code>&quot; directory, as follows, to deploy our &quot;<code>Adoption</code>&quot; smart contract.</p>

<table class="table-program">
<col class="col-line-number" />
<col class="col-program" />
<tbody>
<tr>
<td>
<pre class="text-right">1
2
3
4
5</pre>
</td>
<td>
<pre>
var <span class="color-new">Adoption</span> = artifacts.require(&quot;<span class="color-new">Adoption</span>&quot;);

module.exports = function(deployer) {
  deployer.deploy(<span class="color-new">Adoption</span>);
};</pre>
</td>
</tr>
</tbody>
</table>

<p>Before we can migrate our smart contract to a blockchain, we need a blockchain running. We shall use Ganache, which is a local personal blockchain for Ethereum development. Ganache provides 10 accounts preloaded with 100 <em>fake</em> Ether (ETH). Each account has a unique address and a private key.</p>
<p>See the &quot;Tools&quot; section on how to install Ganache.</p>

<p>Launch Ganache &rArr; Choose &quot;New Workspace&quot; &rArr; In &quot;Workspace Name&quot;, enter &quot;petshop&quot; &rArr; in &quot;Truffle Project&quot;, click &quot;Add Project&quot; and select  &quot;<code>petshop/truffle-config.js</code>&quot; &rArr; &quot;Save Workspace&quot;.</p>

<img src="images/PetShopGanacheStart.png" alt="Ganache Start" width="600" class="image-center" />

<p>Play around and study the Ganache console, which shows that:</p>
<ul>
  <li>The RPC (Remote Procedure Call) server runs on  localhost (127.0.0.1) port number 7545.</li>
  <li>The &quot;<code>ACCOUNTS</code>&quot; panel shows 10 accounts with 100 ETH. Each account has a 20-byte address and a private key.</li>
<li>A block (Block 0) was created. You can select the &quot;<code>BLOCKS</code>&quot; tab to inspect the block.</li>
<li>The &quot;<code>TRANSACTION</code>&quot; panel shows no transactions.</li>
<li>The &quot;<code>CONTRACTS</code>&quot; panel shows 2 contracts (&quot;<code>Adoption</code>&quot; and &quot;<code>Migrations</code>&quot;) that are not deployed yet.</li>
<li>The &quot;<code>EVENTS</code>&quot; panel shows no events.</li>
<li>The &quot;<code>LOGS</code>&quot; panel shows the logs and error messages.</li>
</ul>

<p>Back to CMD/Terminal/Bash-Shell. Issue &quot;<code>truffle migrate</code>&quot; command to migrate (or deploy) our smart contracts:</p>
<pre class="command">
<strong>Truffle migrate</strong>
<span class="color-output">......
1_initial_migration.js
======================
   Deploying 'Migrations'
   ----------------------
   &gt; transaction hash:    0x58f39553c1e3df78dee5196e318444501007edd8028de808f3daeaf7042ff259
   &gt; Blocks: 0            Seconds: 0
   &gt; contract address:    <span class="color-new">0x69d1Ef9557861D3De103E46E2Fd745042aEC1c03</span>
   &gt; block number:        1
   &gt; block timestamp:     1583308281
   &gt; account:             <span class="color-new">0xa9734F4FAC4F27BdC55016F93e676c352B4FbEfD</span> <span class="color-comment">(first account in Ganache)</span>
   &gt; balance:             99.99623034
   &gt; gas used:            188483
   &gt; gas price:           20 gwei
   &gt; value sent:          0 ETH
   &gt; total cost:          0.00376966 ETH

   &gt; Saving migration to chain.
   &gt; Saving artifacts
   -------------------------------------
   &gt; Total cost:          0.00376966 ETH

2_deploy_contracts.js
=====================
......</span></pre>

<p>The Ganache console shows that the state of the blockchain has changed.</p>
<img src="images/PetShopGanacheFirstMigrate.png" alt="Ganache First Migrate" width="600" class="image-center" />

<ul>
<li>Four blocks were created by four transactions by the first account - a &quot;contract creation&quot; and a &quot;contract call&quot; for each smart contract.</li>
<li>The first account, which is the &quot;Sender Address&quot; for all the transactions, has used some ETH for the transaction costs of migration.</li>
<li>Under &quot;<code>CONTRACTS</code>&quot;, two contracts (&quot;<code>Adoption</code>&quot; and &quot;<code>Migrations</code>&quot;) were deployed. Each contract has an address.</li>
<li>Again, play around and study all the panels.</li>
</ul>

<h5>Step 6: Test our Smart Contract</h5>
<p>Proper testing is critical in software development. The Truffle framework provides extensive testing support. The Truffle test scripts can be written in JavaScript or Solidity.</p>
<p>In this example, we shall write our test script in Solidity (the next example is in JavaScript). Create a solidity source file called &quot;<code>TestAdoption.sol</code>&quot; in the &quot;<code>test</code>&quot; directory, as follows:</p>

<table class="table-program">
<col class="col-line-number" />
<col class="col-program" />
<tbody>
<tr>
<td>
<pre class="text-right">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre>
</td>
<td>
<pre>
pragma solidity ^0.5.0;

import &quot;truffle/Assert.sol&quot;;
import &quot;truffle/DeployedAddresses.sol&quot;;
import &quot;../contracts/Adoption.sol&quot;;

contract TestAdoption {
    <span class="color-comment">// Deploy an instance of Adoption smart contract for testing</span>
    Adoption adoption = Adoption(DeployedAddresses.Adoption());
    <span class="color-comment">// The id of the pet that will be used for testing</span>
    uint expectedPetId = 8;
    <span class="color-comment">// The expected owner of adopted pet is this contract</span>
    address expectedAdopter = address(this);

    <span class="color-comment">// Test the adopt() function</span>
    function testAdopt() public {
        uint returnedId = adoption.adopt(expectedPetId);
        Assert.equal(returnedId, expectedPetId, &quot;Adoption of the expected pet should match what is returned.&quot;);
    }

    <span class="color-comment">// Test adopters public getter to retrieve a single pet's owner</span>
    function testAdoptersGetter() public {
        address adopter = adoption.adopters(expectedPetId);
        Assert.equal(adopter, expectedAdopter, &quot;Owner of the expected pet should be this contract&quot;);
    }

    <span class="color-comment">// Test the getAdopters() function to retrieve all pet owners</span>
    function testGetAdopters() public {
        <span class="color-comment">// Store adopters in memory rather than contract's storage</span>
        address[16] memory adopters = adoption.getAdopters();
        Assert.equal(adopters[expectedPetId], expectedAdopter, &quot;Owner of the expected pet should be this contract&quot;);
    }
}</pre>
</td>
</tr>
</tbody>
</table>

<p>Dissecting the code:</p>
<ol>
<li>The script starts with 3 <code>import</code> statements (Line 3-5):
  <ol>
<li><code>truffle/Assert.sol</code>: this smart contract provides the various assertions, such as <code>Assert.equal()</code> used in the script.</li>
<li><code>truffle/DeployAddresses.sol</code>: Truffle deploys a fresh instance of contract being tested to the blockchain. This smart contract gets the address of the deployed contract.</li>
<li><code>Adoption.sol</code>: the smart contract to be tested.</li>
</ol></li>

<li>Next, we declare 3 contract-wide variables:
<ol>
<li><code>Adoption adoption</code>: An instance of the smart contract to be tested. The <code>DeployedAddresses.Adoption()</code> returns its address.</li>
<li><code>uint expectedPetId</code>: The ID of the pet used in testing.</li>
<li><code>address expectedAdopter</code>: The address of <code>TestAdoption</code> contract that will be the sender of the transactions.</li>
</ol></li>

<li><code>testAdopt()</code> (Line 16): Test the <code>.adopt()</code> function of the our <code>Adoption</code> smart contract, which takes a <code>pet-id</code> and returns the same <code>pet-id</code>.</li>
<li><code>testAdoptersGetter()</code> (Line 22): Test the automatic public getter of the variable <code>adopters</code>. For an array <code>adopters</code>, the public getter is <code>.adopters(idx)</code>.</li>
<li><code>testGetAdopters()</code> (Line 28): Test the <code>.getAdopters()</code> function of our <code>Adoption</code> smart contract, which returns the entire <code>address</code> array. The <code>memory</code> attribute asks Solidity to temporarily store the value in memory, rather than saving it to the contract's storage.</li>
</ol>

<p>To run the test, back to the CMD/Terminal and issue:</p>

<pre class="command">
<strong>truffle test</strong>
<span class="color-output">......
  TestAdoption
    √ testUserCanAdoptPet (107ms)
    √ testGetAdopterAddressByPetId (84ms)
    √ testGetAdopterAddressByPetIdInArray (135ms)
  3 passing (9s)</span></pre>
  
<p><span class="lead">Notes</span>: For Windows, there is a bug for Truffle 5.1.15. I revert back to truffle 5.1.10 to avoid the bug.</p>
<pre class="command">
npm uninstall --global truffle
npm install --global truffle@5.1.10</pre>

<h5>(Aside) Truffle Console</h5>

<p>Truffle provides a command-line console. Try it out.</p>

<pre class="command">
<strong>truffle console</strong>
truffle(development)&gt; <strong>Adoption</strong>
<span class="color-output">......</span>
truffle(development)&gt; <strong>Adoption.deployed().then(function(instance) { app = instance })</strong>
<span class="color-output">undefined</span>
truffle(development)&gt; <strong>app</strong>
<span class="color-output">......</span>
truffle(development)&gt; <strong>app.adopters(1)</strong>
<span class="color-output">'0x0000000000000000000000000000000000000000'</span>
truffle(development)&gt; <strong>app.getAdopters()</strong>
<span class="color-output">[
  '0x0000000000000000000000000000000000000000',
  '0x0000000000000000000000000000000000000000',
  ......
]</span></pre>

<h5>Step 7: Create a User Interface with web3.js to interact with our Smart Contract from a Web Browser</h5>
<p>Now, we have (a) written our smart contract, (b) deployed it to our local test blockchain, and (c) tested the functions of the smart contract via the console. We need to create a client-side user interface.</p>
<p>The Pet-Shop Truffle box includes the front-end boilerplate in the &quot;<code>src</code>&quot; directory.</p>

<p>Open the &quot;<code>index.html</code>&quot; under the &quot;<code>src</code>&quot; directory and study the page:</p>

<table class="table-program">
<col class="col-line-number" />
<col class="col-program" />
<tbody>
<tr>
<td>
<pre class="text-right">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre>
</td>
<td>
<pre>
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
    <span class="color-comment">&lt;!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags --&gt;</span>
    &lt;title&gt;Pete's Pet Shop&lt;/title&gt;

    <span class="color-comment">&lt;!-- Bootstrap --&gt;</span>
    &lt;link href=&quot;css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;

    <span class="color-comment">&lt;!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --&gt;
    &lt;!-- WARNING: Respond.js doesn't work if you view the page via file:// --&gt;
    &lt;!--[if lt IE 9]&gt;</span>
      &lt;script src=&quot;https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js&quot;&gt;&lt;/script&gt;
      &lt;script src=&quot;https://oss.maxcdn.com/respond/1.4.2/respond.min.js&quot;&gt;&lt;/script&gt;
    <span class="color-comment">&lt;![endif]--&gt;</span>
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;
      &lt;div class=&quot;row&quot;&gt;
        &lt;div class=&quot;col-xs-12 col-sm-8 col-sm-push-2&quot;&gt;
          &lt;h1 class=&quot;text-center&quot;&gt;Pete's Pet Shop&lt;/h1&gt;
          &lt;hr/&gt;
          &lt;br/&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div id=&quot;<span class="color-new">petsRow</span>&quot; class=&quot;row&quot;&gt;
        <span class="color-comment">&lt;!-- PETS LOAD HERE --&gt;</span>
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;div id=&quot;<span class="color-new">petTemplate</span>&quot; style=&quot;display: none;&quot;&gt;
      &lt;div class=&quot;col-sm-6 col-md-4 col-lg-3&quot;&gt;
        &lt;div class=&quot;panel panel-default panel-pet&quot;&gt;
          &lt;div class=&quot;panel-heading&quot;&gt;
            &lt;h3 class=&quot;panel-title&quot;&gt;Scrappy&lt;/h3&gt;
          &lt;/div&gt;
          &lt;div class=&quot;panel-body&quot;&gt;
            &lt;img alt=&quot;140x140&quot; data-src=&quot;holder.js/140x140&quot; class=&quot;img-rounded img-center&quot; style=&quot;width: 100%;&quot;
              src=&quot;https://animalso.com/wp-content/uploads/2017/01/Golden-Retriever_6.jpg&quot; data-holder-rendered=&quot;true&quot;&gt;
            &lt;br/&gt;&lt;br/&gt;
            &lt;strong&gt;Breed&lt;/strong&gt;: &lt;span class=&quot;pet-breed&quot;&gt;Golden Retriever&lt;/span&gt;&lt;br/&gt;
            &lt;strong&gt;Age&lt;/strong&gt;: &lt;span class=&quot;pet-age&quot;&gt;3&lt;/span&gt;&lt;br/&gt;
            &lt;strong&gt;Location&lt;/strong&gt;: &lt;span class=&quot;pet-location&quot;&gt;Warren, MI&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;
            &lt;button class=&quot;btn btn-default btn-adopt&quot; type=&quot;button&quot; data-id=&quot;0&quot;&gt;Adopt&lt;/button&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    <span class="color-comment">&lt;!-- jQuery (necessary for Bootstrap's JavaScript plugins) --&gt;</span>
    &lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js&quot;&gt;&lt;/script&gt;
    <span class="color-comment">&lt;!-- Include all compiled plugins (below), or include individual files as needed --&gt;</span>
    &lt;script src=&quot;js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;js/web3.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;js/truffle-contract.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;js/app.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
</td>
</tr>
</tbody>
</table>

<p>Dissecting the code:</p>
<ol>
<li>BootStrap is used to layout the web page.</li>
<li>[TODO]</li>
</ol>

<p>Open the JavaScript &quot;<code>src/js/app.js</code>&quot;. The is a global <code>App</code> object to manage our application, load the pet data in <code>init()</code> and then call the function <code>initWeb3()</code>. The web3.js JavaScript library (@ <a href="https://github.com/ethereum/web3.js/">https://github.com/ethereum/web3.js/</a>) interacts with the Ethereum blockchain. It can retrieve user accounts, send transactions, interact with smart contracts, and more.</p>

<p>Replace the &quot;<code>app.js</code>&quot; with the following:</p>

<table class="table-program">
<col class="col-line-number" />
<col class="col-program" />
<tbody>
<tr>
<td>
<pre class="text-right">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106</pre>
</td>
<td>
<pre>
App = {
  web3Provider: null,
  contracts: {},

  init: async function() {
    <span class="color-comment">// Load pets</span>
    $.getJSON('../pets.json', function(data) {
      var <span class="color-new">petsRow = $('#petsRow')</span>;
      var <span class="color-new">petTemplate = $('#petTemplate')</span>;

      for (i = 0; i &lt; data.length; i ++) {
        petTemplate.find('.panel-title').text(data[i].name);
        petTemplate.find('img').attr('src', data[i].picture);
        petTemplate.find('.pet-breed').text(data[i].breed);
        petTemplate.find('.pet-age').text(data[i].age);
        petTemplate.find('.pet-location').text(data[i].location);
        petTemplate.find('.btn-adopt').attr('data-id', data[i].id);

        <span class="color-new">petsRow</span>.append(<span class="color-new">petTemplate</span>.html());
      }
    });

    return await App.initWeb3();
  },

  initWeb3: async function() {
    if (window.ethereum) {  <span class="color-comment">// Modern dapp browsers</span>
      App.web3Provider = window.ethereum;
      try {
        await window.ethereum.enable();  <span class="color-comment">// Request account access</span>
      } catch (error) {  <span class="color-comment">// User denied account access...</span>
        console.error(&quot;User denied account access&quot;)
      }
    } else if (window.web3) {  <span class="color-comment">// Legacy dapp browsers</span>
      App.web3Provider = window.web3.currentProvider;
    } else {  <span class="color-comment">// If no injected web3 instance is detected, fall back to Ganache</span>
      App.web3Provider = new Web3.providers.HttpProvider('http://localhost:7545');
    }
    web3 = new Web3(App.web3Provider);
    return App.initContract();
  },

  initContract: function() {
    $.getJSON('Adoption.json', function(data) {
      <span class="color-comment">// Get the necessary contract artifact file and instantiate it with truffle-contract</span>
      var AdoptionArtifact = data;
      App.contracts.Adoption = TruffleContract(AdoptionArtifact);
      <span class="color-comment">// Set the provider for our contract</span>
      App.contracts.Adoption.setProvider(App.web3Provider);
      <span class="color-comment">// Use our contract to retrieve and mark the adopted pets</span>
      return App.markAdopted();
    });
    return App.bindEvents();
  },

  bindEvents: function() {
    $(document).on('click', '.btn-adopt', App.handleAdopt);
  },

  markAdopted: function(adopters, account) {
    var adoptionInstance;

    App.contracts.Adoption.deployed().then(function(instance) {
      adoptionInstance = instance;
      return adoptionInstance.getAdopters.call();
    }).then(function(adopters) {
      for (i = 0; i &lt; adopters.length; i++) {
        if (adopters[i] !== '0x0000000000000000000000000000000000000000') {
          $('.panel-pet').eq(i).find('button').text('Success').attr('disabled', true);
        }
      }
    }).catch(function(err) {
      console.log(err.message);
    });
  },

  handleAdopt: function(event) {
    event.preventDefault();

    var petId = parseInt($(event.target).data('id'));
    var adoptionInstance;

    web3.eth.getAccounts(function(error, accounts) {
      if (error) {
        console.log(error);
      }
      var account = accounts[0];

      App.contracts.Adoption.deployed().then(function(instance) {
        adoptionInstance = instance;
        <span class="color-comment">// Execute adopt as a transaction by sending account</span>
        return adoptionInstance.adopt(petId, {from: account});
      }).then(function(result) {
        return App.markAdopted();
      }).catch(function(err) {
        console.log(err.message);
      });
    });
  }
};

$(function() {
  $(window).load(function() {
    App.init();
  });
});</pre>
</td>
</tr>
</tbody>
</table>

<p>Dissecting the code:</p>
<ol>
<li>jQuery is used ...</li>
<li>An <code>async</code> function can contain an <code>await</code> expression that pauses the execution of the <code>async</code> function and waits for the passed <code>Promise</code>'s resolution, and then resumes the <code>async</code> function's execution and returns the resolved value. Note that the <code>await</code> keyword is only valid inside <code>async</code> functions.</li>
</ol>

<h5>Step 8: Install and Configure the MetaMask Wallet</h5>
<p>MetaMask Wallet is a browser extension (for  Chrome and Firefox) for managing digital assets via the private key. See the &quot;Tools&quot; section on how to install MetaMask.</p>
<p>To configure MetaMask: Click the &quot;Fox&quot; icon on the browser's icon bar &rArr; In &quot;Welcome to MetaMask&quot;, click &quot;Get Started&quot; &rArr; In &quot;New to MetaMask&quot;, select &quot;Import Wallet&quot; &rArr; In &quot;Wallet Seed&quot;, copy and paste the Ganache's &quot;MNEMONIC&quot; (this 12-word phrase is used to generate your private key) and enter a password &rArr; &quot;All Done&quot; &rArr; Close the tab.</p>
<p>MetaMask can connect to any Ethereum nodes. To connect to our local Ganache blockchain (Check that Ganache has started) &rArr; Pull down &quot;Network&quot; on MetaMask &rArr; Select &quot;Custom RPC&quot; &rArr; In &quot;Network Name&quot;, enter a name say &quot;MyGanache&quot;, in &quot;New RPC URL&quot;, enter &quot;<code>http://localhost:7545</code>&quot;, where our Ganache RPC server is listening &rArr; &quot;Save&quot;. You should see &quot;Account 1&quot; is mapped to Ganache first account with about 100 ETH.</p>

<p>To import an account from Ganache &rArr; Goto Ganache console &rArr; Select an account, say index 5 &rArr; Click the &quot;Key&quot; icon (on the right) to show the private key &rArr; Copy the private key &rArr; Click the &quot;Fox&quot; icon on the browser to pop up MetaMask &rArr; Click the &quot;Circle&quot; icon &rArr; Choose &quot;Import Account&quot; &rArr; Paste the private key copied &rArr; &quot;Import&quot; &rArr; Your shall see a new account called &quot;Account 2&quot; imported from our Ganache with 100 ETH.</p>

<p>Logout MetaMask &rArr; Click on the &quot;Fox&quot; icon on the browser to pop up MetaMask &rArr; Click on the &quot;Circle&quot; icon &rArr; Choose &quot;Logout&quot;.</p>

<h5>Step 9: Set up the lite-Server</h5>

<p>Lite-server is a lightweight development web server (HTTP server) with supports for Single Page Applications (SPAs). It is shipped with Truffle Box Pet-Shop (kept under &quot;<code>petshop/node_modules/lite-server</code>&quot;).</p>

<p>The lite-server is configured in &quot;<code>bs-config.json</code>&quot;, as follows:</p>

<pre class="color-example">
{
  <span class="color-new">&quot;server&quot;: {
    &quot;baseDir&quot;: [&quot;./src&quot;, &quot;./build/contracts&quot;]
  }</span>
}</pre>

<p>The above configuration puts both directories &quot;<code>src</code>&quot; (which contains the HTML/CSS/JS) and &quot;<code>build/contracts</code>&quot; (which contains the smart contract artifacts) as the base-directory (or root-directory) of the server.</p>

<p>In &quot;<code>package.json</code>&quot;, we included the following &quot;<code>scripts</code>&quot; object to add an alias &quot;<code>dev</code>&quot; to &quot;<code>lite-server</code>&quot;. That is, the command &quot;<code>npm run dev</code>&quot; launch the lite-server.</p>
<pre class="color-example">
  &quot;scripts&quot;: {
    <span class="color-new">&quot;dev&quot;: &quot;lite-server&quot;</span>,
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
  },</pre>


<h5>Step 10: Run our Pet-Shop Dapp</h5>

<p>Re-start the Ganache to get a clean state.</p>
<p>On CMD/Terminal, issue truffle migrate command with <code>--reset</code> option to reset the previous smart contracts:</p>
<pre class="command">
<strong>truffle migrate --reset</strong>
<span class="color-output">Starting migrations...
......
&gt; Total deployments:   2
&gt; Final cost:          0.00907878 ETH</span></pre>

<p>Now, start the lite-server:</p>
<pre class="command">
<strong>npm run dev</strong>
<span class="color-output">&gt; pet-shop@1.0.0 dev ...\petshop
&gt; lite-server
......</span>
</pre>

<p>A new browser tab is started at &quot;<code>http://localhost:3000</code>&quot;, displaying the &quot;<code>index.html</code>&quot; under &quot;<code>src</code>&quot; directory &rArr;  MetaMask pops up, if you have logged out &rArr; Enter your password &rArr; In &quot;Connect Request&quot;, click &quot;Connect&quot;.</p>
<p>Click on the &quot;Fox&quot; icon again &rArr; Click the &quot;Circle&quot; icon &rArr; choose an &quot;Account&quot; with some ETH &rArr; If all accounts have zero ETH, import one from Ganache (Select a Ganache account &rArr; Click the &quot;key&quot; icon to reveal the private key &rArr; Copy the private key &rArr; In MetaMask, choose &quot;Import Account&quot; &rArr; Paste the private key.)</p>
<p>Now, goto the web page &rArr; Select a pet &rArr; Click &quot;Adopt&quot; &rArr; MetaMask Pops up showing the transaction details &rArr; Click &quot;Confirm&quot; &rArr; The &quot;Adopt&quot; button changes to &quot;Success&quot; and disabled.</p>

<p><span class="color-new">Congratulations!</span> It is pretty hard to reach here (It took me one whole night)!</p>

<h5>Step 11: Shutting Down</h5>
<ul>
<li>You can shutdown the lite-server via Ctrl-C to terminate the batch job.</li>
<li>Logout MetaMask.</li>
</ul>


<h4>Example 2: An eVoting Dapp</h4>
<h5>References:</h5>
<ol>
<li>Gregory McCubbin, &quot;How to Build a Full Stack Decentralized Application Step-By-Step&quot; @ <a href="https://www.dappuniversity.com/articles/the-ultimate-ethereum-dapp-tutorial">https://www.dappuniversity.com/articles/the-ultimate-ethereum-dapp-tutorial</a>.</li>
<li>Gleb B., Ihor D. &quot; How To Build an Ethereum Smart Contract for a Blockchain Marketplace&quot; @ <a href="https://rubygarage.org/blog/ethereum-smart-contract-tutorial">https://rubygarage.org/blog/ethereum-smart-contract-tutorial</a>, with code in &quot;<a href="https://github.com/dappuniversity/election">https://github.com/dappuniversity/election</a>&quot;.</li>
</ol>

<p>You need to read and understand the &quot;Pet-Shop&quot; example, before attempting this example.</p>

<h5>Step 1: Create a Truffle Project and Unbox the Truffle Box Pet-Shop</h5>

<p>Create a project directory called &quot;<code>eVoting</code>&quot; and unbox the Truffle box &quot;Pet-Shop&quot; as the boilerplate.</p>
<p>Start a CMD/Terminal/Bash-Shell and issue these commands:</p>
<pre class="command">
<strong>cd /path/to/base-directory
mkdir evoting
cd evoting
truffle unbox pet-shop</strong></pre>

<h5>Step 2: Write our Smart Contracts</h5>

<p>Create a Solidity source file called &quot;<code>EVoting.sol</code>&quot; under the &quot;<code>contracts</code>&quot; directory as follows:</p>

<table class="table-program">
<col class="col-line-number" />
<col class="col-program" />
<tbody>
<tr>
<td>
<pre class="text-right">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre>
</td>
<td>
<pre>
pragma solidity ^0.5.0;

contract Evoting {
    <span class="color-comment">// Model a Candidate</span>
    struct Candidate {
        uint id;  <span class="color-comment">// starts from 1</span>
        string name;
        uint numVotes;
    }

    <span class="color-comment">// All Candidates by id</span>
    mapping(uint =&gt; Candidate) public candidates;

    <span class="color-comment">// Number of Candidates</span>
    uint public numCandidates;

    <span class="color-comment">// Store the addresses that have already voted</span>
    mapping(address =&gt; bool) public voters;

    <span class="color-comment">// To trigger this event whenever a vote is cast</span>
    event votedEvent (
        uint indexed _candidateId
    );

    <span class="color-comment">// Add a candidate by name into the mapping, auto-increment id</span>
    function addCandidate (string memory _name) private {
        ++numCandidates;
        candidates[numCandidates] = Candidate(numCandidates, _name, 0);
    }

    <span class="color-comment">// Constructor</span>
    constructor() public {
        addCandidate(&quot;Alice&quot;);  <span class="color-comment">// id is 1</span>
        addCandidate(&quot;Bob&quot;);    <span class="color-comment">// id is 2</span>
    }

    <span class="color-comment">// The caller address casts a vote for a candidate</span>
    function vote (uint _candidateId) public {
        <span class="color-comment">// require that they haven't voted before</span>
        require(!voters[msg.sender], &quot;already voted&quot;);

        <span class="color-comment">// require a valid candidate</span>
        require(_candidateId &gt; 0 &amp;&amp; _candidateId &lt;= numCandidates, &quot;invalid candidate id&quot;);

        <span class="color-comment">// record that voter has voted</span>
        voters[msg.sender] = true;  <span class="color-comment">// msg.sender is the caller address</span>

        <span class="color-comment">// update candidate vote Count</span>
        ++candidates[_candidateId].numVotes;

        <span class="color-comment">// trigger voted event</span>
        emit votedEvent(_candidateId);
    }
}</pre>
</td>
</tr>
</tbody>
</table>

<p>Dissecting the code:</p>
<ol>
<li>[TODO]</li>
<li>[TODO]</li>
</ol>

<p>Try compiling the smart contract as follows:</p>
<pre class="command">
<strong>truffle compile</strong>
&gt; Compiling .\contracts\<span class="color-new">Evoting.sol</span>
&gt; Compiling .\contracts\<span class="color-new">Migrations.sol</span>
&gt; Artifacts written to ...\evoting\build\contracts
&gt; Compiled successfully using:
   - solc: 0.5.16+commit.9c3226ce.Emscripten.clang</pre>

<h5>Step 3: Migrate to the Ganache Local Personal Blockchain</h5>

<p>Under the &quot;<code>Migrations</code>&quot; directory, the Pet-Shop has provided a JavaScript called &quot;<code>1_initial_migration.js</code>&quot;, used for deploying &quot;<code>Migrations</code>&quot; smart contract. We shall write the second script called "<code>2_deploy_contracts.js</code>" to deploy our smart contract, as follows:</p>

<pre class="color-example">
var <span class="color-new">Evoting</span> = artifacts.require(&quot;<span class="color-new">Evoting</span>&quot;);

module.exports = function(deployer) {
  deployer.deploy(<span class="color-new">Evoting</span>);
};</pre>

<p>Launch Ganache &rArr; Choose &quot;New Workspace&quot; &rArr; In &quot;Workspace Name&quot;, enter &quot;Evoting&quot; &rArr; in &quot;Truffle Project&quot;, click &quot;Add Project&quot; and select  &quot;<code>evoting/truffle-config.js</code>&quot; &rArr; &quot;Save Workspace&quot;.</p>
<p>Issue this command:</p>
<pre class="command">
<strong>truffle migrate</strong>
<span class="color-output">......
2_deploy_contracts.js
=====================
   Deploying '<span class="color-new">Evoting</span>'
......</span></pre>

<h5>Step 4: Test our Smart Contract</h5>

<p>Write the following test script (in JavaScript) called &quot;<code>TestEvoting.js</code>&quot; and save in the &quot;<code>test</code>&quot; directory:</p>

<table class="table-program">
<col class="col-line-number" />
<col class="col-program" />
<tbody>
<tr>
<td>
<pre class="text-right">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89</pre>
</td>
<td>
<pre>
var evoting = artifacts.require(&quot;./evoting.sol&quot;);

contract(&quot;evoting&quot;, function(accounts) {
  var evotingInstance;

  it(&quot;initializes with two candidates&quot;, function() {
    return evoting.deployed().then(function(instance) {
      return instance.numCandidates();
    }).then(function(count) {
      assert.equal(count, 2);
    });
  });

  it(&quot;initializes the candidates with the correct values&quot;, function() {
    return evoting.deployed().then(function(instance) {
      evotingInstance = instance;
      return evotingInstance.candidates(1);
    }).then(function(candidate) {
      assert.equal(candidate[0], 1, &quot;contains the correct id&quot;);
      assert.equal(candidate[1], &quot;Alice&quot;, &quot;contains the correct name&quot;);
      assert.equal(candidate[2], 0, &quot;contains the correct votes count&quot;);
      return evotingInstance.candidates(2);
    }).then(function(candidate) {
      assert.equal(candidate[0], 2, &quot;contains the correct id&quot;);
      assert.equal(candidate[1], &quot;Bob&quot;, &quot;contains the correct name&quot;);
      assert.equal(candidate[2], 0, &quot;contains the correct votes count&quot;);
    });
  });

  it(&quot;allows a voter to cast a vote&quot;, function() {
    return evoting.deployed().then(function(instance) {
      electionInstance = instance;
      candidateId = 1;
      return electionInstance.vote(candidateId, { from: accounts[0] });
    }).then(function(receipt) {
      assert.equal(receipt.logs.length, 1, &quot;an event was triggered&quot;);
      assert.equal(receipt.logs[0].event, &quot;votedEvent&quot;, &quot;the event type is correct&quot;);
      assert.equal(receipt.logs[0].args._candidateId.toNumber(), candidateId, &quot;the candidate id is correct&quot;);
      return electionInstance.voters(accounts[0]);
    }).then(function(voted) {
      assert(voted, &quot;the voter was marked as voted&quot;);
      return electionInstance.candidates(candidateId);
    }).then(function(candidate) {
      var numVotes = candidate[2];
      assert.equal(numVotes, 1, &quot;increments the candidate's vote count&quot;);
    })
  });

  it(&quot;throws an exception for invalid candidates&quot;, function() {
    return evoting.deployed().then(function(instance) {
      evotingInstance = instance;
      return evotingInstance.vote(99, { from: accounts[1] })
    }).then(assert.fail).catch(function(error) {
      assert(error.message.indexOf('revert') &gt;= 0, &quot;error message must contain revert&quot;);
      return evotingInstance.candidates(1);
    }).then(function(candidate1) {
      var numVotes = candidate1[2];
      assert.equal(numVotes, 1, &quot;Alice did not receive any votes&quot;);
      return evotingInstance.candidates(2);
    }).then(function(candidate2) {
      var numVotes = candidate2[2];
      assert.equal(numVotes, 0, &quot;Bob did not receive any votes&quot;);
    });
  });

  it(&quot;throws an exception for double voting&quot;, function() {
    return evoting.deployed().then(function(instance) {
      evotingInstance = instance;
      candidateId = 2;
      evotingInstance.vote(candidateId, { from: accounts[1] });
      return evotingInstance.candidates(candidateId);
    }).then(function(candidate) {
      var numVotes = candidate[2];
      assert.equal(numVotes, 1, &quot;accepts first vote&quot;);
      <span class="color-comment">// Try to vote again</span>
      return evotingInstance.vote(candidateId, { from: accounts[1] });
    }).then(assert.fail).catch(function(error) {
      assert(error.message.indexOf('revert') &gt;= 0, &quot;error message must contain revert&quot;);
      return evotingInstance.candidates(1);
    }).then(function(candidate1) {
      var numVotes = candidate1[2];
      assert.equal(numVotes, 1, &quot;Alice did not receive any votes&quot;);
      return evotingInstance.candidates(2);
    }).then(function(candidate2) {
      var numVotes = candidate2[2];
      assert.equal(numVotes, 1, &quot;Bob did not receive any votes&quot;);
    });
  });
});</pre>
</td>
</tr>
</tbody>
</table>

<p>Issue the following Truffle command to run the test:</p>
<pre class="command">
<strong>truffle test</strong>
<span class="color-output">  <span class="color-new">Contract: Evoting</span>
    √ initializes with two candidates
    √ initializes the candidates with the correct values (118ms)
    √ allows a voter to cast a vote (211ms)
    √ throws an exception for invalid candidates (154ms)
    √ throws an exception for double voting (263ms)
  <span class="color-new">5 passing</span> (863ms)</span></pre>

<h5>Step 5: Create the Client-Side User Interface</h5>

<p>Under &quot;<code>src</code>&quot; directory, replace &quot;<code>index.html</code>&quot; with the following:</p>
<table class="table-program">
<col class="col-line-number" />
<col class="col-program" />
<tbody>
<tr>
<td>
<pre class="text-right">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></td>
<td>
<pre>
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
    &lt;title&gt;E-Voting Results&lt;/title&gt;
    <span class="color-comment">&lt;!-- Bootstrap --&gt;</span>
    &lt;link href=&quot;css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class=&quot;container&quot; style=&quot;width: 650px;&quot;&gt;
      &lt;div class=&quot;row&quot;&gt;
        &lt;div class=&quot;col-lg-12&quot;&gt;
          &lt;h1 class=&quot;text-center&quot;&gt;E-Voting Results&lt;/h1&gt;
          &lt;hr/&gt;
          &lt;br/&gt;
          &lt;div id=&quot;loader&quot;&gt;
            &lt;p class=&quot;text-center&quot;&gt;Loading...&lt;/p&gt;
          &lt;/div&gt;
          &lt;div id=&quot;content&quot; style=&quot;display: none;&quot;&gt;
            &lt;table class=&quot;table&quot;&gt;
              &lt;thead&gt;
                &lt;tr&gt;
                  &lt;th scope=&quot;col&quot;&gt;#&lt;/th&gt;
                  &lt;th scope=&quot;col&quot;&gt;Name&lt;/th&gt;
                  &lt;th scope=&quot;col&quot;&gt;Votes&lt;/th&gt;
                &lt;/tr&gt;
              &lt;/thead&gt;
              &lt;tbody id=&quot;candidatesResults&quot;&gt;
              &lt;/tbody&gt;
            &lt;/table&gt;
            &lt;hr/&gt;
            &lt;p id=&quot;accountAddress&quot; class=&quot;text-center&quot;&gt;&lt;/p&gt;

            &lt;form onSubmit=&quot;App.castVote(); return false;&quot;&gt;
              &lt;div class=&quot;form-group&quot;&gt;
                &lt;label for=&quot;candidatesSelect&quot;&gt;Select Candidate&lt;/label&gt;
                &lt;select class=&quot;form-control&quot; id=&quot;candidatesSelect&quot;&gt;
                &lt;/select&gt;
              &lt;/div&gt;
              &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Vote&lt;/button&gt;
              &lt;hr /&gt;
            &lt;/form&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    <span class="color-comment">&lt;!-- jQuery (necessary for Bootstrap's JavaScript plugins) --&gt;</span>
    &lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js&quot;&gt;&lt;/script&gt;
    <span class="color-comment">&lt;!-- Include all compiled plugins (below), or include individual files as needed --&gt;</span>
    &lt;script src=&quot;js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;js/web3.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;js/truffle-contract.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;js/app.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
</td>
</tr>
</tbody>
</table>

<p>Dissecting the Code:</p>
<ol>
<li>[TODO]</li>
<li>[TODO]</li>
</ol>



<p>Under &quot;<code>src/js</code>&quot; directory, replace &quot;<code>app.js</code>&quot; with the following:</p>

<table class="table-program">
<col class="col-line-number" />
<col class="col-program" />
<tbody>
<tr>
<td>
<pre class="text-right">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</pre>
</td>
<td>
<pre>
App = {
  web3Provider: null,
  contracts: {},
  account: '0x0',
  hasVoted: false,

  init: async function() {
    return await App.initWeb3();
  },

  initWeb3: async function() {
    if (window.ethereum) {  <span class="color-comment">// Modern dapp browsers</span>
      App.web3Provider = window.ethereum;
      try {
        await window.ethereum.enable();  <span class="color-comment">// Request account access</span>
      } catch (error) {  <span class="color-comment">// User denied account access...</span>
        console.error(&quot;User denied account access&quot;)
      }
    } else if (window.web3) {  <span class="color-comment">// Legacy dapp browsers</span>
      App.web3Provider = window.web3.currentProvider;
    } else {  <span class="color-comment">// If no injected web3 instance is detected, fall back to Ganache</span>
      App.web3Provider = new Web3.providers.HttpProvider('http://localhost:7545');
    }
    web3 = new Web3(App.web3Provider);
    return App.initContract();
  },

  initContract: function() {
    $.getJSON(&quot;Evoting.json&quot;, function(data) {
      <span class="color-comment">// Instantiate a new truffle contract from the artifact</span>
      App.contracts.Evoting = TruffleContract(data);
      <span class="color-comment">// Connect provider to interact with contract</span>
      App.contracts.Evoting.setProvider(App.web3Provider);

      App.listenForEvents();

      return App.render();
    });
  },

  <span class="color-comment">// Listen for events emitted from the contract</span>
  listenForEvents: function() {
    App.contracts.Evoting.deployed().then(function(instance) {
      <span class="color-comment">// Restart Chrome if you are unable to receive this event</span>
      <span class="color-comment">// This is a known issue with MetaMask</span>
      <span class="color-comment">// https://github.com/MetaMask/metamask-extension/issues/2393</span>
      instance.votedEvent({}, {
        fromBlock: 0,
        toBlock: 'latest'
      }).watch(function(error, event) {
        console.log(&quot;event triggered&quot;, event)
        <span class="color-comment">// Reload when a new vote is recorded</span>
        App.render();
      });
    });
  },

  render: function() {
    var evotingInstance;
    var loader = $(&quot;#loader&quot;);
    var content = $(&quot;#content&quot;);

    loader.show();
    content.hide();

    <span class="color-comment">// Load account data</span>
    web3.eth.getAccounts(function(err, accounts) {
      if (err) {
         console.log(err);
      }
      App.account = accounts[0];
      $(&quot;#accountAddress&quot;).html(&quot;Your Account: &quot; + App.account);
    });

    <span class="color-comment">// Load contract data</span>
    App.contracts.Evoting.deployed().then(function(instance) {
      evotingInstance = instance;
      return evotingInstance.numCandidates();
    }).then(function(numCandidates) {
      var candidatesResults = $(&quot;#candidatesResults&quot;);
      candidatesResults.empty();

      var candidatesSelect = $('#candidatesSelect');
      candidatesSelect.empty();

      for (var i = 1; i &lt;= numCandidates; i++) {
        evotingInstance.candidates(i).then(function(candidate) {
          var id = candidate[0];
          var name = candidate[1];
          var numVotes = candidate[2];

          <span class="color-comment">// Render candidate Result</span>
          var candidateTemplate = &quot;&lt;tr&gt;&lt;th&gt;&quot; + id + &quot;&lt;/th&gt;&lt;td&gt;&quot; + name + &quot;&lt;/td&gt;&lt;td&gt;&quot; + numVotes + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;
          candidatesResults.append(candidateTemplate);

          <span class="color-comment">// Render candidate ballot option</span>
          var candidateOption = &quot;&lt;option value='&quot; + id + &quot;' &gt;&quot; + name + &quot;&lt;/ option&gt;&quot;
          candidatesSelect.append(candidateOption);
        });
      }
      return evotingInstance.voters(App.account);
    }).then(function(hasVoted) {
      <span class="color-comment">// Do not allow a user to vote</span>
      if(hasVoted) {
        $('form').hide();
      }
      loader.hide();
      content.show();
    }).catch(function(error) {
      console.warn(error);
    });
  },

  castVote: function() {
    var candidateId = $('#candidatesSelect').val();
    App.contracts.Evoting.deployed().then(function(instance) {
      return instance.vote(candidateId, { from: App.account });
    }).then(function(result) {
      <span class="color-comment">// Wait for votes to update</span>
      $(&quot;#content&quot;).hide();
      $(&quot;#loader&quot;).show();
    }).catch(function(err) {
      console.error(err);
    });
  }
};

$(function() {
  $(window).load(function() {
    App.init();
  });
});</pre>
</td>
</tr>
</tbody>
</table>

<p>Dissecting the Code:</p>
<ol>
<li>[TODO]</li>
<li>[TODO]</li>
</ol>



<h5>Step 6: Setup and Configure MetaMask</h5>
<p>See &quot;Pet-Shop&quot; example, if you have not done so.</p>

<h5>Step 7: Run our Evoting Dapp</h5>

<p>Issue these commands:</p>
<pre class="command">
<strong>truffle migrate --reset</strong>
<strong>npm run dev</strong></pre>

<p>[TODO] There are still some bugs in the &quot;app.js&quot; to be fixed.</p>

<h3>Ethereum Blockchain Technologies Review [Work In Progress]</h3>

<h4>Solidity Programming Language</h4>

<p><span class="lead">Reference</span>: Solidity @ <a href="https://solidity.readthedocs.io/en/v0.6.3/">https://solidity.readthedocs.io/en/v0.6.3/</a>.</p>

<p>Solidity is an high-level, object-oriented programming language for implementing smart contracts, to be run under the Ethereum Virtual Machine (EVM).</p>
<p>Solidity is statically typed, supports inheritance, libraries and complex user-defined types.</p>

<pre class="color-syntax">
progma solidity ^0.5.0
contract <em>ContractName</em> {
   <span class="color-comment">// variables</span>
   unit myNumber = 1;

   <span class="color-comment">// arrays</span>
   unit[5] aFixedLengthArray;
   unit[] aNonFixedLengthArray;

   <span class="color-comment">// user-defined structures</span>
   struct Certificate {
      address recipientAddress;
      uint recipientID;
   }
   Certificate[] certificates;
   ......
}</pre>

<h5>&quot;<span class="font-code">contract</span>&quot; Class</h5>
<p>A smart contract is contained within the <code>contract</code> class.</p>

<h5>&quot;<span class="font-code">progma solidity</span>&quot; Compiler Directive</h5>
<p>The <code>program solidity</code> compiler directive specifies the solidity version number. [TODO]</p>

<h5>Variables and Types</h5>
<p>All variables are stored in the blockchain. Hence, we must be careful of the value assignment or updates, because it will incur cost. [TODO]</p>

<h5>Array and User-Defined Structure (<span class="font-code">struct</span>)</h5>
<p>[TODO]</p>

<h5>Functions</h5>
<pre class="color-syntax">
Syntax:

Example:
function addition(unit _x, uint _y) returns (uint) {   // default is public
   return _x + _y;
}

function subtraction((unit _x, uint _y) private returns (uint) {
}</pre>

<p>[TODO]</p>

<h5>public vs. private</h5>

<p>For public variables, a getter is automatically generated. [TODO]</p>
<p>private entities are accessible within the contract only.</p>

<h5>view and pure</h5>

<pre class="color-syntax">string msg = &quot;hello, world&quot;;
function getMsg() public view returns (string) {
   return msg;
}
function greeting(string _msg) public pure returns (string) {
   return _msg;
}</pre>
<p>view: there is no change in state.</p>
<p>pure: not even accessing any variables.</p>

<h5>require()</h5>

<pre class="color-syntax">
contract ... {
   address public owner;

   function checkOwner(address _address) returns (bool) {
      require(owner == _address, &quot;The address given is not the owner&quot;);
   }
}</pre>

<p>Instead of using if-else statement, it is recommended to use require(condition, errMsg), because it will automatically throw an error and revert the flow if the condition is not met.</p>
<p>Starting from Solidity 5, you need to provide an error message string and the second argument.</p>

<h4>Web3.js</h4>
<p>Web3.js is an Ethereum JavaScript API for interacting with the Ethereum Nodes, via HTTP or IPC.</p>

<h5>Setting up Web3 providers</h5>
<p>[TODO]</p>

<h5>Instantiate a Web3 Contract</h5>
<p>In order to communicate with the smart contract, Web3 needs two parameters:</p>
<ol>
<li>address of the contract</li>
<li>ABI</li>
</ol>

<p>The deployed smart contract can be instantiated as follows:</p>
<pre class="color-syntax">
var myContract = new web3.eth.Contract(myABI, myContractAddress);</pre>

<p>[TODO]</p>

<h5>Invoking Smart Contract Functions</h5>
<p>There are two methods to invoke smart contract's functions, namely call and send.</p>
<ol>
<li><code>call</code>: The <code>call</code> method does not create transaction on the Ethereum blockchain, instead, it only reads from the blockchain. Hence, it does not incur any cost.
<pre class="color-example">
myContract.methods.readDetails(&quot;user&quot;).call();</pre>
</li>
<li>send: The send method does create a transaction and change data on the Ethereum blockchain. It requires user to pay &quot;gas&quot; to the miner for the transaction.
<pre class="color-example">
myContract.methods.writeDetails(&quot;user&quot;).send();</pre>
</li>
</ol>

<p>&nbsp;</p>
<p>&nbsp;</p>

<!-- @@ start change in v1 -->
<p class="references">REFERENCES &amp; RESOURCES</p>

</div> <!-- End the content-main division -->

<div id="content-footer">
<p>Latest version tested: Windows/firefox/Chrome, Truffle v5.1.10, Solidity v0.5.16, Node v12.16.1, Web3.js v1.2.1<br />
Last modified: March, 2020</p>
</div>

</div>  <!-- End the wrap-inner division -->

<!-- ===================================================================== -->
	
	

<!-- @@ v3 footer changes starts here, before "footer", to end of document -->
<!-- footer filled by JavaScript -->
<div id="footer" class="footer"><p>&nbsp;</p></div>

</div>  <!-- End the wrap-outer division -->

<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<!-- My custom JavaScript v3 -->
<script src="../scripts/programming_notes_v3.js"></script>
<!-- Prism Syntax Highlighter -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>
